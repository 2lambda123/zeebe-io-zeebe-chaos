<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Blog Atom Feed"><title data-react-helmet="true">Experiment with Low Load | Zeebe Chaos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeebe-io.github.io/zeebe-chaos/2020/08/06/low-load"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Experiment with Low Load | Zeebe Chaos"><meta data-react-helmet="true" name="description" content="* Run a benchmark with low load"><meta data-react-helmet="true" property="og:description" content="* Run a benchmark with low load"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2020-08-06T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/zelldon"><link data-react-helmet="true" rel="shortcut icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-react-helmet="true" rel="canonical" href="https://zeebe-io.github.io/zeebe-chaos/2020/08/06/low-load"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2020/08/06/low-load" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2020/08/06/low-load" hreflang="x-default"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.878b0132.css">
<link rel="preload" href="/zeebe-chaos/assets/js/runtime~main.a618c4f3.js" as="script">
<link rel="preload" href="/zeebe-chaos/assets/js/main.6f41b5ad.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zeebe-io/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS">Standalone Gateway in CCSaaS</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/02/01/High-Snapshot-Frequency">High Snapshot Frequency</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/01/19/big-variables">Handling of Big Variables</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance">Worker count should not impact performance</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Experiment with Low Load</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2020-08-06T00:00:00.000Z" itemprop="datePublished">August 6, 2020</time> Â· 3 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/zelldon.png" alt="Christopher Zell"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christopher Zell</span></a></div><small class="avatar__subtitle" itemprop="description">Chaos Engineer @ Zeebe</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><ul><li>Run a benchmark with low load</li><li>Investigate last benchmark failures</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="chaos-experiment"></a>Chaos Experiment<a class="hash-link" href="#chaos-experiment" title="Direct link to heading">#</a></h2><p> We currently seem to have issues with RocksDB, which sometimes generates a lot of SST files during the Broker lifetime. This causes to fail the snapshot replication at some point.
This is especially problematic after pod&#x27;s get restarted, since a follower normally need either to be catched up with the log or the leader will send a snapshot to the follower.
If the snapshot contains a lot of files this get&#x27;s problematic. In order to understand this better we would like to find out how we can reproduce it. We expected this happens only on low load,
the assumption is that RocksDB will not trigger the compaction so often, because we are not reaching a certain threshold. See the related issue <a href="https://github.com/zeebe-io/zeebe/issues/4887" target="_blank" rel="noopener noreferrer">#4887</a> .</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="expected"></a>Expected<a class="hash-link" href="#expected" title="Direct link to heading">#</a></h3><p> When creating workflow instances and completing them directly afterwards we normally expect that there is nothing left and nothing should accumulate together. If we do it on low load, which means 1 workflow instance creation and completion per second then we expect the same. Furthermore we expect that the used resources are lower then on higher load.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="actual"></a>Actual<a class="hash-link" href="#actual" title="Direct link to heading">#</a></h3><p> We have setup our default benchmark with three partition, three nodes and replication factor three. We starting one workflow instance at a time. We running one worker, which completes the related workflow.</p><p>In the general overview we can see that we start and complete one workflow per second.
<img alt="general" src="/zeebe-chaos/assets/images/general-one-workflow-23b6ac315531261b67f51825470c1644.png"></p><p>The resource consumption looks ok.
<img alt="resource" src="/zeebe-chaos/assets/images/resources-one-workflow-3d9f5643ae307a587750fd1b8ce5dd3b.png"></p><p>But the RocksDB used size and snapshot files seem to be increasing.
<img alt="rocks1" src="/zeebe-chaos/assets/images/rocks1-f8199bda1be44e00cba4128d19d75f37.png">
<img alt="rocks2" src="/zeebe-chaos/assets/images/rocks2-c59ae6867a414e62cf53d9f3b230b378.png">
<img src="https://user-images.githubusercontent.com/2758593/89533130-384fcc80-d7f3-11ea-83b8-69bbe75f5211.png" alt="snapshot"></p><p>I will let the benchmark run a bit longer and I think we need to investigate this issue further.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="investigation-last-benchmark"></a>Investigation Last Benchmark<a class="hash-link" href="#investigation-last-benchmark" title="Direct link to heading">#</a></h2><p>Every week I create a benchmark on the chaos day and let it run until the next chaos day. Since I had not much time for trying out other experiments today and I saw that the old benchmark has problems I decided to investigated why the processing went down. I collected here my observations and use this more as a summary, since until now it is not clear what is the issue.</p><p>In the general overview we can see that the processing is in avg under 100 workflow instances per second, normally we would expect something around 130. We can also see that the processing in general is not that stable.
<img alt="general" src="/zeebe-chaos/assets/images/general-554b0628baa23a11900618380b29ecd5.png"></p><p>If we take a look at the partitions separatly we can see that the partition two died quite early.</p><p><strong>Partition 1 last 7 days</strong>
<img src="https://user-images.githubusercontent.com/2758593/89543087-cb433380-d800-11ea-9d03-27d60a6cc49d.png" alt="partition-1-general-7-days">
<strong>Partition 2 last 7 days</strong>
<img src="https://user-images.githubusercontent.com/2758593/89543091-cb433380-d800-11ea-80ab-922c483cd039.png" alt="partition-2-general-7-days">
<strong>Partition 3 last 7 days</strong>
<img src="https://user-images.githubusercontent.com/2758593/89543093-cbdbca00-d800-11ea-9e86-d14b165e02eb.png" alt="partition-3-general-7-days"></p><p>We can see that the processing seem to be stopped for the partition two and never comes back. This seem to happen on the 31-07-2020 ~ 2 pm.
With the resource panel we can also see that at this time a node preemption happen, since all pod seem to be rescheduled. This can be seen based on the different colors of the graphs.</p><p><img src="https://user-images.githubusercontent.com/2758593/89543095-cbdbca00-d800-11ea-962e-aee3fa95a826.png" alt="resources"></p><p>In the log we can see that all brokers are getting closed.</p><p>Interesting is that we see the day after, an continously growing disk usage, which never gets reduced.</p><p><img src="https://user-images.githubusercontent.com/2758593/89543083-c9797000-d800-11ea-82f3-a1b505811171.png" alt="disk-usage"></p><p>Currently I don&#x27;t understand what was the issue and why it never comes back. I created an issue to further investigate that <a href="https://github.com/zeebe-io/zeebe/issues/5127" target="_blank" rel="noopener noreferrer">#5127</a> . I will keep the old benchmark running and will setup a separe one in order to reproduce this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="participants"></a>Participants<a class="hash-link" href="#participants" title="Direct link to heading">#</a></h2><ul><li>@zelldon</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Experiment with Camunda Cloud</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zeebe-chaos/2020/07/30/experiment-without-exporters"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Experiment without Exporters Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chaos-experiment" class="table-of-contents__link">Chaos Experiment</a><ul><li><a href="#expected" class="table-of-contents__link">Expected</a></li><li><a href="#actual" class="table-of-contents__link">Actual</a></li></ul></li><li><a href="#investigation-last-benchmark" class="table-of-contents__link">Investigation Last Benchmark</a></li><li><a href="#participants" class="table-of-contents__link">Participants</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zeebe-io/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zeebe-chaos/assets/js/runtime~main.a618c4f3.js"></script>
<script src="/zeebe-chaos/assets/js/main.6f41b5ad.js"></script>
</body>
</html>