"use strict";(self.webpackChunkzell_chaos=self.webpackChunkzell_chaos||[]).push([[4228],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),d=o,m=u["".concat(l,".").concat(d)]||u[d]||h[d]||s;return n?a.createElement(m,r(r({ref:t},p),{},{components:n})):a.createElement(m,r({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,r=new Array(s);r[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var c=2;c<s;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1938:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return h}});var a=n(7462),o=n(3366),s=(n(7294),n(3905)),r=["components"],i={layout:"posts",title:"Disconnect Leader and one Follower",date:new Date("2021-01-07T00:00:00.000Z"),categories:["chaos_experiment","broker","bpmn"],tags:["availability"],authors:"zell"},l="Chaos Day Summary",c={permalink:"/zeebe-chaos/2021/01/07/disconnect-leader-and-follower",editUrl:"https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2021-01-07-disconnect-leader-and-follower/index.md",source:"@site/blog/2021-01-07-disconnect-leader-and-follower/index.md",title:"Disconnect Leader and one Follower",description:"Happy new year everyone",date:"2021-01-07T00:00:00.000Z",formattedDate:"January 7, 2021",tags:[{label:"availability",permalink:"/zeebe-chaos/tags/availability"}],readingTime:7.64,truncated:!0,authors:[{name:"Christopher Zell",title:"Chaos Engineer @ Zeebe",url:"https://github.com/zelldon",imageURL:"https://github.com/zelldon.png",key:"zell"}],prevItem:{title:"Network partitions",permalink:"/zeebe-chaos/2021/01/19/network-partition"},nextItem:{title:"Message Correlation after Failover",permalink:"/zeebe-chaos/2020/11/24/message-correlation-after-failover"}},p={authorsImageUrls:[void 0]},h=[{value:"Preparation",id:"preparation",children:[{value:"Resources",id:"resources",children:[]},{value:"Script",id:"script",children:[]}]},{value:"Chaos Experiment",id:"chaos-experiment",children:[{value:"Hypothesis",id:"hypothesis",children:[]},{value:"Actual",id:"actual",children:[]}]},{value:"Result",id:"result",children:[]},{value:"New Issues",id:"new-issues",children:[]},{value:"Participants",id:"participants",children:[]}],u={toc:h};function d(e){var t=e.components,i=(0,o.Z)(e,r);return(0,s.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Happy new year everyone \ud83c\udf89"),(0,s.kt)("p",null,"This time I wanted to verify the following hypothesis ",(0,s.kt)("inlineCode",{parentName:"p"},"Disconnecting Leader and one Follower should not make cluster disruptive")," (",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zeebe-io/zeebe-chaos/issues/45"},"#45"),").\nBut in order to do that we need to extract the Leader and Follower node for a partition from the Topology. Luckily in December we got an ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zeebe-io/zeebe/pull/5943"},"external contribution")," which allows us to print ",(0,s.kt)("inlineCode",{parentName:"p"},"zbctl status")," as json.\nThis gives us now more possibilities, since we can extract values much better out of it."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"TL;DR")," The experiment was successful \ud83d\udc4d"),(0,s.kt)("h2",{id:"preparation"},"Preparation"),(0,s.kt)("p",null,"Before we start with the experiment I wanted to extract the right node id's for the follower's and leader from the ",(0,s.kt)("inlineCode",{parentName:"p"},"zbctl status")," output via ",(0,s.kt)("inlineCode",{parentName:"p"},"jq"),". If we have that we can use this for other use cases."),(0,s.kt)("p",null,"I stored the ",(0,s.kt)("inlineCode",{parentName:"p"},"zbctl")," json output in a file, to make the lines a bit more readable and that I can focus on the jq stuff. The tested output looks like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'$ cat test.json \n{\n  "brokers": [\n    {\n      "nodeId": 1,\n      "host": "zeebe-chaos-zeebe-1.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local",\n      "port": 26501,\n      "partitions": [\n        {\n          "partitionId": 1,\n          "role": "LEADER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 2,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 3,\n          "role": "LEADER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 4,\n          "role": "LEADER",\n          "health": "HEALTHY"\n        }\n      ],\n      "version": "0.27.0-SNAPSHOT"\n    },\n    {\n      "nodeId": 2,\n      "host": "zeebe-chaos-zeebe-2.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local",\n      "port": 26501,\n      "partitions": [\n        {\n          "partitionId": 1,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 2,\n          "role": "LEADER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 3,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 4,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        }\n      ],\n      "version": "0.27.0-SNAPSHOT"\n    },\n    {\n      "nodeId": 0,\n      "host": "zeebe-chaos-zeebe-0.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local",\n      "port": 26501,\n      "partitions": [\n        {\n          "partitionId": 1,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 2,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 3,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        },\n        {\n          "partitionId": 4,\n          "role": "FOLLOWER",\n          "health": "HEALTHY"\n        }\n      ],\n      "version": "0.27.0-SNAPSHOT"\n    }\n  ],\n  "clusterSize": 3,\n  "partitionsCount": 4,\n  "replicationFactor": 3,\n  "gatewayVersion": "0.27.0-SNAPSHOT"\n}\n')),(0,s.kt)("p",null,"I had a really hard time to find the correct ",(0,s.kt)("inlineCode",{parentName:"p"},"jq")," expression, but here is it:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'$ cat test.json | jq ".brokers[]|select(.partitions[]| select(.partitionId == 3) and .role == \\"LEADER\\")"\n')),(0,s.kt)("p",null,"You may ask why there are multiple ",(0,s.kt)("a",{parentName:"p",href:"https://stedolan.github.io/jq/manual/#select(boolean_expression)"},"selects"),". I tried it previous with one and the issue is that it then works like an cartesian-product. It takes broker objects, which take part of the partition 3 and it will take broker objects, which are leader for an partition into the output. This is obviously not that what I want.\nThe current expression filters brokers for partitions which have the partitionId and are leader for that partition. This ",(0,s.kt)("a",{parentName:"p",href:"https://gist.github.com/olih/f7437fb6962fb3ee9fe95bda8d2c8fa4#gistcomment-3257810"},"gist comment")," helped me here."),(0,s.kt)("p",null,"Examples:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'$ cat test.json | jq ".brokers[]|select(.partitions[]| select(.partitionId == 3) and .role == \\"LEADER\\")|.nodeId"\n1\n$ cat test.json | jq ".brokers[]|select(.partitions[]| select(.partitionId == 2) and .role == \\"LEADER\\")|.nodeId"\n2\n')),(0,s.kt)("p",null,"Later I realized that this doesn't work for followers, since you can have multiple ones, BUT also this can be solved. ",(0,s.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/38500363/get-the-first-or-nth-element-in-a-jq-json-parsing"},"Just put it in an array and get the first entry"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'jq "[.brokers[]|select(.partitions[]| select(.partitionId == $partition) and .role == \\"$state\\")][0].nodeId\n')),(0,s.kt)("p",null,"As you can see ",(0,s.kt)("inlineCode",{parentName:"p"},"jq")," is quite powerful and I learned a lot about it this day. If you interested you can also check ",(0,s.kt)("a",{parentName:"p",href:"https://stedolan.github.io/jq/manual/"},"the manual")," which has ton's of examples."),(0,s.kt)("h3",{id:"resources"},"Resources"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/18592173/select-objects-based-on-value-of-variable-in-object-using-jq"},"https://stackoverflow.com/questions/18592173/select-objects-based-on-value-of-variable-in-object-using-jq")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/questions/404699/using-multiple-wildcards-in-jq-to-select-objects-in-a-json-file"},"https://unix.stackexchange.com/questions/404699/using-multiple-wildcards-in-jq-to-select-objects-in-a-json-file")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://stedolan.github.io/jq/manual/#Builtinoperatorsandfunctions"},"https://stedolan.github.io/jq/manual/#Builtinoperatorsandfunctions")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/33057420/jq-select-multiple-conditions"},"https://stackoverflow.com/questions/33057420/jq-select-multiple-conditions")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/stedolan/jq/issues/319"},"https://github.com/stedolan/jq/issues/319")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/questions/491669/jq-get-attribute-of-nested-object"},"https://unix.stackexchange.com/questions/491669/jq-get-attribute-of-nested-object")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/27562424/jq-nested-object-extract-top-level-id-and-lift-a-value-from-internal-object"},"https://stackoverflow.com/questions/27562424/jq-nested-object-extract-top-level-id-and-lift-a-value-from-internal-object")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("em",{parentName:"li"},"false track")," ",(0,s.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/28615174/jq-filter-on-sub-object-value"},"https://stackoverflow.com/questions/28615174/jq-filter-on-sub-object-value")),(0,s.kt)("li",{parentName:"ul"},"final key: ",(0,s.kt)("a",{parentName:"li",href:"https://gist.github.com/olih/f7437fb6962fb3ee9fe95bda8d2c8fa4#gistcomment-3257810"},"https://gist.github.com/olih/f7437fb6962fb3ee9fe95bda8d2c8fa4#gistcomment-3257810"))),(0,s.kt)("h3",{id:"script"},"Script"),(0,s.kt)("p",null,"I was able to replace the old utility:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'function getIndexOfPodForPartitionInState()\n{\n  partition="$1"\n  state="$2"\n  pod=$(getGateway)\n  namespace=$(getNamespace)\n\n  # To print the topology in the journal\n  until topology="$(kubectl exec "$pod" -n "$namespace" -- zbctl status --insecure)"\n  do\n    true;\n  done\n\n\n  # For cluster size 3 and replication factor 3\n  # we know the following partition matrix\n  # partition \\ node  0    1     2\n  #     1             L    F     F\n  #     2             F    L     F\n  #     3             F    F     L\n  #    etc.\n  # This means broker 1, 2 or 3 participates on partition 3\n  # BE AWARE the topology above is just an example and the leader can every node participating node.\n\n  index=$(($(echo "$topology" \\\n    | grep "Partition $partition" \\\n    | grep -n "$state" -m 1 \\\n    | sed \'s/\\([0-9]*\\).*/\\1/\') - 1))\n  echo "$index"\n}\n')),(0,s.kt)("p",null,"With this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'function getIndexOfPodForPartitionInState()\n{\n  partition="$1"\n  state="$2"\n  pod=$(getGateway)\n  namespace=$(getNamespace)\n\n  # To print the topology in the journal\n  until topology="$(kubectl exec "$pod" -n "$namespace" -- zbctl status --insecure -o json)"\n  do\n    true;\n  done\n\n  index=$(echo "$topology" | jq "[.brokers[]|select(.partitions[]| select(.partitionId == $partition) and .role == \\"$state\\")][0].nodeId")\n  echo "$index"\n}\n')),(0,s.kt)("p",null,"The previous function worked only with homogeneous clusters, which means where the partitions are equally distributed. This caused issues on experiments on Production L clusters, where partitions are heterogeneous distributed, see related issue ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zeebe-io/zeebe-cluster-testbench/issues/154"},"zeebe-io/zeebe-cluster-testbench#154"),". With this new utility we can create some new experiments also for Production - L clusters."),(0,s.kt)("p",null,"I wrote a new script based on the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-experiments/scripts/disconnect-standalone-gateway.sh"},"older disconnect/connect gateway scripts"),", where we disconnect the gateway with the brokers. The new one disconnects an leader for an partition with the follower and vice-versa."),(0,s.kt)("p",null,"Disconnect Leader-Follower:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},'#!/bin/bash\nset -exuo pipefail\n\nsource utils.sh\n\npartition=1\nnamespace=$(getNamespace)\ngateway=$(getGateway)\n\n# determine leader for partition\nindex=$(getIndexOfPodForPartitionInState "$partition" "LEADER")\nleader=$(getBroker "$index")\nleaderIp=$(kubectl get pod "$leader" -n "$namespace" --template="{ {.status.podIP} }")\n\nindex=$(getIndexOfPodForPartitionInState "$partition" "FOLLOWER")\nfollower=$(getBroker "$index")\nfollowerIp=$(kubectl get pod "$follower" -n "$namespace" --template="{ {.status.podIP} }")\n\n# To print the topology in the journal\nretryUntilSuccess kubectl exec "$gateway" -n "$namespace" -- zbctl status --insecure\n\n# we put all into one function because we need to make sure that even after preemption the \n# dependency is installed\nfunction disconnect() {\n toChangedPod="$1"\n targetIp="$2"\n\n # update to have access to ip\n kubectl exec -n "$namespace" "$toChangedPod" -- apt update\n kubectl exec -n "$namespace" "$toChangedPod" -- apt install -y iproute2\n kubectl exec "$toChangedPod" -n "$namespace" -- ip route add unreachable "$targetIp"\n\n}\n\nretryUntilSuccess disconnect "$leader" "$followerIp"\nretryUntilSuccess disconnect "$follower" "$leaderIp" \n')),(0,s.kt)("h2",{id:"chaos-experiment"},"Chaos Experiment"),(0,s.kt)("p",null,"We want to disconnect a leader and a follower from a specific partition."),(0,s.kt)("h3",{id:"hypothesis"},"Hypothesis"),(0,s.kt)("p",null,"We expect that even if the leader and the follower can't talk with each other the follower is not able to disrupt the cluster and no new election is started, such that he becomes the leader.\nOn reconnect we expect that the follower keeps up again and is eventually on the same page with the other follower and leader."),(0,s.kt)("h3",{id:"actual"},"Actual"),(0,s.kt)("p",null,"We deployed a cluster with one partition for simplicity. We run the above posted script to disconnect one leader with a follower and the same follower with the leader."),(0,s.kt)("h4",{id:"disconnect"},"Disconnect"),(0,s.kt)("p",null,"After running the disconnect script we see in general no disruption. The processing is still continuing."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(7938).Z})),(0,s.kt)("p",null,"We can see that the followers misses a lot of heartbeats, which is expected."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(5297).Z})),(0,s.kt)("p",null,"This is also visible in the logs:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"2021-01-07 20:22:28.320 CET\nzeebe-chaos-zeebe-0\nRaftServer{raft-partition-partition-1}{role=FOLLOWER} - No heartbeat from null in the last PT2.98S (calculated from last 2980 ms), sending poll requests\n2021-01-07 20:22:28.321 CET\nzeebe-chaos-zeebe-0\nRaftServer{raft-partition-partition-1}{role=FOLLOWER} - Poll request to 1 failed: io.netty.channel.AbstractChannel$AnnotatedConnectException: connect(..) failed: No route to host: zeebe-chaos-zeebe-1.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local/10.0.0.7:26502\n2021-01-07 20:22:28.625 CET\nzeebe-chaos-zeebe-1\nRaftServer{raft-partition-partition-1} - AppendRequest{term=1, leader=1, prevLogIndex=2643199, prevLogTerm=1, entries=0, checksums=0, commitIndex=2755920} to 0 failed: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: connect(..) failed: No route to host: zeebe-chaos-zeebe-0.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local/10.0.7.13:26502\n2021-01-07 20:22:28.977 CET\nzeebe-chaos-zeebe-1\nRaftServer{raft-partition-partition-1} - AppendRequest{term=1, leader=1, prevLogIndex=2643199, prevLogTerm=1, entries=0, checksums=0, commitIndex=2756276} to 0 failed: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: connect(..) failed: No route to host: zeebe-chaos-zeebe-0.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local/10.0.7.13:26502\n2021-01-07 20:22:29.382 CET\nzeebe-chaos-zeebe-1\nRaftServer{raft-partition-partition-1} - AppendRequest{term=1, leader=1, prevLogIndex=2643199, prevLogTerm=1, entries=0, checksums=0, commitIndex=2756571} to 0 failed: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: connect(..) failed: No route to host: zeebe-chaos-zeebe-0.zeebe-chaos-zeebe.zeebe-chaos.svc.cluster.local/10.0.7.13:26502\n")),(0,s.kt)("p",null,"The follower is failing  to send poll requests to Broker-1, which is the leader. I assume we don't see that the follower sends the other follower poll requests because our log level is to high.\nFurthermore we can see that the leader is not able to send append requests. We have a panel where we can see how many entries the follower lags behind."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(8678).Z})),(0,s.kt)("p",null,"Interesting that the java heap of the follower is growing."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(5010).Z})),(0,s.kt)("p",null,"But after some time GC steps in and it goes back to normal."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(3316).Z})),(0,s.kt)("h4",{id:"connect"},"Connect"),(0,s.kt)("p",null,"After running the connect script we can see in the log that almost immediately a snapshot is send to the follower."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"D 2021-01-07T19:26:24.042908Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk 000333.log of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\nD 2021-01-07T19:26:24.045690Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk 000334.sst of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\nD 2021-01-07T19:26:24.052229Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk 000335.log of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\nD 2021-01-07T19:26:24.068270Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk 000336.sst of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\nD 2021-01-07T19:26:24.076135Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk CURRENT of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\nD 2021-01-07T19:26:24.081880Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk MANIFEST-000003 of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\nD 2021-01-07T19:26:24.089900Z zeebe-chaos-zeebe-0 Consume snapshot snapshotChunk OPTIONS-000090 of snapshot 2643199-1-1610047230637-3215713-3214967  zeebe-chaos-zeebe-0\n")),(0,s.kt)("p",null,"This is also visible in the metrics"),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(5707).Z})),(0,s.kt)("p",null,"We see a healed raft."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(5106).Z})),(0,s.kt)("p",null,"What I was wondering is why the metric which shows the lag of the follower is not really recovering."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(6776).Z})),(0,s.kt)("p",null,"Even after almost 12 hours it is still showing ~4K"),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(8061).Z})),(0,s.kt)("h2",{id:"result"},"Result"),(0,s.kt)("p",null,"As we can see the experiment was successful, we were able to verify our hypothesis. The new extraction of the leader and follower from the topology gives us new possibilities for new chaos experiments.\nI think we can also experiment a bit more with disconnecting different nodes, to see how the cluster behaves."),(0,s.kt)("h2",{id:"new-issues"},"New Issues"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Metric: Follower lag doesn't recover")),(0,s.kt)("h2",{id:"participants"},"Participants"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"@zelldon")))}d.isMDXComponent=!0},8061:function(e,t,n){t.Z=n.p+"assets/images/failing-metric-c363880bb7fb57b7dc9a40b01e86545d.png"},7938:function(e,t,n){t.Z=n.p+"assets/images/general-938c446793091f9fb5b8aa5c13435b01.png"},5106:function(e,t,n){t.Z=n.p+"assets/images/healed-raft-523127360be6b5750d2d52428ed00e08.png"},5297:function(e,t,n){t.Z=n.p+"assets/images/heartbeats-e178f780060b967d8c5748a7de390971.png"},3316:function(e,t,n){t.Z=n.p+"assets/images/later-gc-7c3d259d82ab97139cdcc22496ef3320.png"},6776:function(e,t,n){t.Z=n.p+"assets/images/metrics-is-not-correct-574cdd8d0d22b8d62145b132cdf10d1d.png"},5707:function(e,t,n){t.Z=n.p+"assets/images/raft-snap-3f95d18c325b9228ff52a4ae00ebc895.png"},5010:function(e,t,n){t.Z=n.p+"assets/images/resources-follower-3f36ecf328d6f31df4a86fcb17dff4de.png"},8678:function(e,t,n){t.Z=n.p+"assets/images/slow-follower-91a64717a739d49ce14bd269b4bf9142.png"}}]);