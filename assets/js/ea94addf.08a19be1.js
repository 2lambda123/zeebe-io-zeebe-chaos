"use strict";(self.webpackChunkzell_chaos=self.webpackChunkzell_chaos||[]).push([[7792],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var i=a.createContext({}),c=function(e){var t=a.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(r),u=n,m=h["".concat(i,".").concat(u)]||h[u]||d[u]||o;return r?a.createElement(m,l(l({ref:t},p),{},{components:r})):a.createElement(m,l({ref:t},p))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,l=new Array(o);l[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[h]="string"==typeof e?e:n,l[1]=s;for(var c=2;c<o;c++)l[c]=r[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},22830:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=r(87462),n=(r(67294),r(3905));const o={layout:"posts",title:"Worker count should not impact performance",date:new Date("2021-11-24T00:00:00.000Z"),categories:["chaos_experiment","bpmn","performance"],tags:["performance"],authors:"zell"},l="Chaos Day Summary",s={permalink:"/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance",editUrl:"https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2021-11-24-Worker-count-should-not-impact-performance/index.md",source:"@site/blog/2021-11-24-Worker-count-should-not-impact-performance/index.md",title:"Worker count should not impact performance",description:"In this chaos day we experimented with the worker count, since we saw recently that it might affect the performance (throughput) negatively if there are more workers deployed. This is related to #7955 and #8244.",date:"2021-11-24T00:00:00.000Z",formattedDate:"November 24, 2021",tags:[{label:"performance",permalink:"/zeebe-chaos/tags/performance"}],readingTime:2.5,hasTruncateMarker:!0,authors:[{name:"Christopher Zell",title:"Chaos Engineer @ Zeebe",url:"https://github.com/zelldon",imageURL:"https://github.com/zelldon.png",key:"zell"}],frontMatter:{layout:"posts",title:"Worker count should not impact performance",date:"2021-11-24T00:00:00.000Z",categories:["chaos_experiment","bpmn","performance"],tags:["performance"],authors:"zell"},prevItem:{title:"Handling of Big Variables",permalink:"/zeebe-chaos/2022/01/19/big-variables"},nextItem:{title:"Not produce duplicate Keys",permalink:"/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys"}},i={authorsImageUrls:[void 0]},c=[{value:"First Chaos Experiment",id:"first-chaos-experiment",level:2},{value:"Expected",id:"expected",level:3},{value:"Actual",id:"actual",level:3},{value:"4 Worker",id:"4-worker",level:4},{value:"8 Worker",id:"8-worker",level:4},{value:"16 Worker",id:"16-worker",level:4},{value:"Result",id:"result",level:5},{value:"Second Chaos Experiment",id:"second-chaos-experiment",level:2},{value:"Expected",id:"expected-1",level:3},{value:"Actual",id:"actual-1",level:3},{value:"4 Worker",id:"4-worker-1",level:4},{value:"8 Worker",id:"8-worker-1",level:4},{value:"16 Worker",id:"16-worker-1",level:4},{value:"Result",id:"result-1",level:5},{value:"Third Chaos Experiment",id:"third-chaos-experiment",level:2},{value:"Expected",id:"expected-2",level:3},{value:"Actual",id:"actual-2",level:3},{value:"4 Worker",id:"4-worker-2",level:4},{value:"8 Worker",id:"8-worker-2",level:4},{value:"16 Worker",id:"16-worker-2",level:4},{value:"Result",id:"result-2",level:5},{value:"Further Analysis",id:"further-analysis",level:2}],p={toc:c},h="wrapper";function d(e){let{components:t,...o}=e;return(0,n.kt)(h,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"In this chaos day we experimented with the worker count, since we saw recently that it might affect the performance (throughput) negatively if there are more workers deployed. This is related to ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/camunda-cloud/zeebe/issues/7955"},"#7955")," and ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/camunda-cloud/zeebe/issues/8244"},"#8244"),"."),(0,n.kt)("p",null,"We wanted to prove, that even if we have more workers deployed the throughput of the process instance execution should not have an negative impact."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"TL;DR;")," We were not able to prove our hypothesis. Scaling of workers can have a negative impact on performance. Check out the ",(0,n.kt)("a",{parentName:"p",href:"#third-chaos-experiment"},"third chaos experiment"),"."),(0,n.kt)("h2",{id:"first-chaos-experiment"},"First Chaos Experiment"),(0,n.kt)("p",null,"We run the first experiment with one partition, three brokers, one standalone gateway and one starter which creates 100 PI/s. In this experiment we deployed different zeebe ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/camunda-cloud/zeebe/tree/develop/benchmarks"},"benchmarks")," with 4, 8 and 16 workers."),(0,n.kt)("h3",{id:"expected"},"Expected"),(0,n.kt)("p",null,"The workers should be able to complete all created instances and if the workers are scaled the throughput should remain."),(0,n.kt)("h3",{id:"actual"},"Actual"),(0,n.kt)("h4",{id:"4-worker"},"4 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-4-p1-general.png",src:r(30925).Z,width:"1828",height:"902"})),(0,n.kt)("h4",{id:"8-worker"},"8 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-8-p1-general.png",src:r(38953).Z,width:"1833",height:"901"})),(0,n.kt)("h4",{id:"16-worker"},"16 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-16-p1-general.png",src:r(52095).Z,width:"1826",height:"897"})),(0,n.kt)("h5",{id:"result"},"Result"),(0,n.kt)("p",null,"What we can see is that if we increase the worker number it will decrease the throughput, this might be explained with the case that we sent more activation requests / commands which need to be handled by the Brokers. We can see that the back pressure is higher with 16 workers."),(0,n.kt)("h2",{id:"second-chaos-experiment"},"Second Chaos Experiment"),(0,n.kt)("p",null,"We will repeat first experiment with some changes, to the partition count. We will now use three partitions."),(0,n.kt)("h3",{id:"expected-1"},"Expected"),(0,n.kt)("p",null,"The workers should be able to complete all created instances and if the workers are scaled the throughput should remain or be better."),(0,n.kt)("h3",{id:"actual-1"},"Actual"),(0,n.kt)("h4",{id:"4-worker-1"},"4 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-4-p3-general.png",src:r(4626).Z,width:"1840",height:"898"})),(0,n.kt)("h4",{id:"8-worker-1"},"8 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-8-p3-general.png",src:r(28907).Z,width:"1836",height:"903"})),(0,n.kt)("h4",{id:"16-worker-1"},"16 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-16-p3-general.png",src:r(16012).Z,width:"1832",height:"906"})),(0,n.kt)("h5",{id:"result-1"},"Result"),(0,n.kt)("p",null,"In this experiment we can see that all benchmarks reach almost the same throughput, since we not really stressing the system and have enough resources to work with. There is no backpressure at all. In the next experiment we will increase the load."),(0,n.kt)("h2",{id:"third-chaos-experiment"},"Third Chaos Experiment"),(0,n.kt)("p",null,"We will repeat second experiment with some changes to the instance creation count. We will now start 300 process instances per second, with one starter."),(0,n.kt)("h3",{id:"expected-2"},"Expected"),(0,n.kt)("p",null,"The workers should be able to complete most of the instances, we would expect that with more workers we would be able to complete more instances and have no negative impact on the system."),(0,n.kt)("h3",{id:"actual-2"},"Actual"),(0,n.kt)("h4",{id:"4-worker-2"},"4 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-4-p3-300-general.png",src:r(7612).Z,width:"1825",height:"903"})),(0,n.kt)("h4",{id:"8-worker-2"},"8 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-8-p3-general.png",src:r(67921).Z,width:"1832",height:"911"})),(0,n.kt)("h4",{id:"16-worker-2"},"16 Worker"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-16-p3-general.png",src:r(80082).Z,width:"1837",height:"915"})),(0,n.kt)("h5",{id:"result-2"},"Result"),(0,n.kt)("p",null,"Between eight and four workers we see the expected difference, that more workers increases the throughput and we are able to complete more instances in a second. The result of 16 workers is completely unexpected. We observed that after short time frame the completion throughput completely droped, and only process instances are created. "),(0,n.kt)("p",null,"We were able to reproduce this behavior, which shows the weakness again."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"worker-16-p3-general-reproduce.png",src:r(78344).Z,width:"1827",height:"886"})),(0,n.kt)("p",null,"We were not able to prove our hypothesis, that scaling of workers has no negative impact on performance."),(0,n.kt)("h2",{id:"further-analysis"},"Further Analysis"),(0,n.kt)("p",null,"We created a bug issue to analyze and fix this weakness ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/camunda-cloud/zeebe/issues/8267"},"#8267"),"."))}d.isMDXComponent=!0},52095:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-16-p1-general-6af6d38ff8109ecc304b34fb149d24dc.png"},78344:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-16-p3-300-general-reproduce-23ede1412500950de080d9b90f080400.png"},80082:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-16-p3-300-general-edb0fc05b8ef76f9991a26e215232366.png"},16012:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-16-p3-general-9e04e4d183f59d59573917fc264a04e0.png"},30925:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-4-p1-general-62ffbfc05a0d98a217d628ea1c11dfe0.png"},7612:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-4-p3-300-general-632f8cc19401a161b90ab68bef7978ed.png"},4626:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-4-p3-general-3e773f9f2734c854f579cf560474f558.png"},38953:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-8-p1-general-d9a0c1f55aeb25f8a41b43f0caf44f47.png"},67921:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-8-p3-300-general-32b3a55b2d73fc15983195071742b18c.png"},28907:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/worker-8-p3-general-25f411adf3701877e4ab7a040b401434.png"}}]);