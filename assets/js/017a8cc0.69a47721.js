"use strict";(self.webpackChunkzell_chaos=self.webpackChunkzell_chaos||[]).push([[2744],{3905:(t,e,a)=>{a.d(e,{Zo:()=>p,kt:()=>g});var n=a(7294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function s(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},l=Object.keys(t);for(n=0;n<l.length;n++)a=l[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)a=l[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var o=n.createContext({}),d=function(t){var e=n.useContext(o),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},p=function(t){var e=d(t.components);return n.createElement(o.Provider,{value:e},t.children)},u="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},m=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,l=t.originalType,o=t.parentName,p=s(t,["components","mdxType","originalType","parentName"]),u=d(a),m=r,g=u["".concat(o,".").concat(m)]||u[m]||c[m]||l;return a?n.createElement(g,i(i({ref:e},p),{},{components:a})):n.createElement(g,i({ref:e},p))}));function g(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=a.length,i=new Array(l);i[0]=m;var s={};for(var o in e)hasOwnProperty.call(e,o)&&(s[o]=e[o]);s.originalType=t,s[u]="string"==typeof t?t:r,i[1]=s;for(var d=2;d<l;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},9531:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var n=a(7462),r=(a(7294),a(3905));const l={layout:"posts",title:"Experiment with Camunda Cloud",date:new Date("2020-08-20T00:00:00.000Z"),categories:["chaos_experiment","cloud"],authors:"zell"},i="Chaos Day Summary",s={permalink:"/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud",editUrl:"https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2020-08-20-experiment-with-camunda-cloud/index.md",source:"@site/blog/2020-08-20-experiment-with-camunda-cloud/index.md",title:"Experiment with Camunda Cloud",description:"In order to make our chaos experiments more realistic we have setup a new gke cluster, which is similar to the Camunda Cloud gke cluster.",date:"2020-08-20T00:00:00.000Z",formattedDate:"August 20, 2020",tags:[],readingTime:3.875,hasTruncateMarker:!0,authors:[{name:"Christopher Zell",title:"Chaos Engineer @ Zeebe",url:"https://github.com/zelldon",imageURL:"https://github.com/zelldon.png",key:"zell"}],frontMatter:{layout:"posts",title:"Experiment with Camunda Cloud",date:"2020-08-20T00:00:00.000Z",categories:["chaos_experiment","cloud"],authors:"zell"},prevItem:{title:"Play around with ToxiProxy",permalink:"/zeebe-chaos/2020/10/06/toxi-proxy"},nextItem:{title:"Experiment with Low Load",permalink:"/zeebe-chaos/2020/08/06/low-load"}},o={authorsImageUrls:[void 0]},d=[{value:"Configurations of Zeebe Clusters",id:"configurations-of-zeebe-clusters",level:2},{value:"Benchmarks",id:"benchmarks",level:2},{value:"Throughput",id:"throughput",level:3},{value:"Latency",id:"latency",level:3},{value:"Other Observations",id:"other-observations",level:3},{value:"Running automated Chaos experiments",id:"running-automated-chaos-experiments",level:2},{value:"Participants",id:"participants",level:2}],p={toc:d},u="wrapper";function c(t){let{components:e,...l}=t;return(0,r.kt)(u,(0,n.Z)({},p,l,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In order to make our chaos experiments more realistic we have setup a new gke cluster, which is similar to the Camunda Cloud gke cluster.\nIt allows us to test and experiment with Zeebe clusters which have the same configuration as Zeebe clusters in the Camunda cloud."),(0,r.kt)("p",null,"As part of the chaos day I run the same benchmark we normally run in our gke with our configuration against the Camunda Cloud Zeebe clusters."),(0,r.kt)("h2",{id:"configurations-of-zeebe-clusters"},"Configurations of Zeebe Clusters"),(0,r.kt)("p",null,"In the following table I want to highlight the different configurations of the different Zeebe Clusters (cluster types)."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Our Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Prod S"),(0,r.kt)("th",{parentName:"tr",align:null},"Prod M"),(0,r.kt)("th",{parentName:"tr",align:null},"Prod L"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Partitions"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"8")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Nodes"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Replication"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SnapshotPeriod"),(0,r.kt)("td",{parentName:"tr",align:null},"15"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"5")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CPU_THREADS"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"4")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"IO_THREADS"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"4")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CPU LIMIT"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"4")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CPU REQUEST"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"200m"),(0,r.kt)("td",{parentName:"tr",align:null},"200m"),(0,r.kt)("td",{parentName:"tr",align:null},"200m")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"RAM LIMIT"),(0,r.kt)("td",{parentName:"tr",align:null},"12Gi"),(0,r.kt)("td",{parentName:"tr",align:null},"2Gi"),(0,r.kt)("td",{parentName:"tr",align:null},"8Gi"),(0,r.kt)("td",{parentName:"tr",align:null},"8Gi")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"RAM REQUEST"),(0,r.kt)("td",{parentName:"tr",align:null},"12Gi"),(0,r.kt)("td",{parentName:"tr",align:null},"250Mi"),(0,r.kt)("td",{parentName:"tr",align:null},"250Mi"),(0,r.kt)("td",{parentName:"tr",align:null},"250Mi")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Gateway"),(0,r.kt)("td",{parentName:"tr",align:null},"Standalone"),(0,r.kt)("td",{parentName:"tr",align:null},"Embedded"),(0,r.kt)("td",{parentName:"tr",align:null},"Embedded"),(0,r.kt)("td",{parentName:"tr",align:null},"Embedded")))),(0,r.kt)("h2",{id:"benchmarks"},"Benchmarks"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Our Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Prod S"),(0,r.kt)("th",{parentName:"tr",align:null},"Prod M"),(0,r.kt)("th",{parentName:"tr",align:null},"Prod L"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"General"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"base",src:a(128).Z,width:"1846",height:"922"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(9850).Z,width:"1850",height:"638"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(5543).Z,width:"1839",height:"679"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(5985).Z,width:"1835",height:"903"}))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Resources"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"base",src:a(3502).Z,width:"1826",height:"634"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(7770).Z,width:"1838",height:"679"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(6335).Z,width:"1835",height:"672"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(145).Z,width:"1838",height:"668"}))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Disk usage"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(8148).Z,width:"1843",height:"276"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(1370).Z,width:"1830",height:"277"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(3687).Z,width:"1834",height:"283"}))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Latency"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"base",src:a(9818).Z,width:"1853",height:"911"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(9523).Z,width:"1842",height:"862"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(9392).Z,width:"1834",height:"852"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(4384).Z,width:"1829",height:"910"}))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Working"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"base",src:a(128).Z,width:"1846",height:"922"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(4558).Z,width:"1838",height:"681"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(7706).Z,width:"1839",height:"683"})),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("img",{alt:"prods",src:a(5327).Z,width:"1849",height:"689"}))))),(0,r.kt)("p",null,"In general we can see that the clusters haven't survived long. This is also visible in our Camunda Cloud status page.\n",(0,r.kt)("img",{alt:"status",src:a(8660).Z,width:"1397",height:"523"})),(0,r.kt)("p",null,"I think it is kind of related with the preemtable nodes, high load, long restarts and that pods are restarted after 15 minutes, when there are not getting ready.\nOne of the reasons why restarting takes so long is fixed now with ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zeebe-io/zeebe/pull/5189"},"#5189")," so I hope that this gets better. But currently it is an issue, since you start replicating a snapshot and reprocess on start up. If this takes longer then 15 min the pod will be restarted because of this configuration: ",(0,r.kt)("inlineCode",{parentName:"p"},"Liveness:   http-get http://:9600/ready delay=900s timeout=1s period=15s #success=1 #failure=3")," after restarting the pod you haven't gained any value you just need to start again the complete procedure. In k8 we can see a high restart count of the pods."),(0,r.kt)("p",null,"Interesting is if we take a look at the working part of Prod S then we clearly see how often actually a pod is preemted or leader change happens."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"prod-s",src:a(4558).Z,width:"1838",height:"681"})),(0,r.kt)("p",null,"It is a known issue that currently the nodes are preemted quite often in Camunda Cloud and they working on a solution to it."),(0,r.kt)("h3",{id:"throughput"},"Throughput"),(0,r.kt)("p",null,"If we take a look at the Working part we can see that we scale based on the partition count (or prod cluster sizes) in Camunda Cloud. For Prod S we reach in avg ~24 workflow instance creation/completions per second. For Prod M we reach in avg ~46 workflow instance creation/completions per second. For Prod L we reach in avg ~99 workflow instance creations and completions. To be fair I run the benchmark on these cluster sizes only with three workers, which have 8 threads an activation count of 120 and they completing an job after 150 ms delay, and an starter which starts 100 workflow instances per second. Normally we use in our benchmarks 12 workers and start 300 workflow instances per second. I tried that with the Prod L cluster, but this failed quite fast after increasing the load. Here we probably need to investigate further. If we take a look at our cluster setup then we reach in avg ~147 workflow instance creations/completions per second."),(0,r.kt)("h3",{id:"latency"},"Latency"),(0,r.kt)("p",null,"If take a look at the latency we can see that in Prod M cluster the latency seems to be a bit problematic, where in Prod S and L it seems similar. In our default cluster we get the best latency. Might be worth to take a look as well."),(0,r.kt)("h3",{id:"other-observations"},"Other Observations"),(0,r.kt)("p",null,"During the benchmark observations I saw that some metrics are missing."),(0,r.kt)("p",null,"For example the Gateway metrics are not shown:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"gw",src:a(7840).Z,width:"1821",height:"671"})),(0,r.kt)("p",null,"Furthermore I saw that all container related and pvc related metrics are missing. I was not able to check the IO metrics nor the CPU metrics and other."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"io",src:a(2970).Z,width:"1833",height:"682"})),(0,r.kt)("p",null,"If we want to run more tests and chaos experiments we need to fix these missing metrics before. Opened a new issue for it ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/camunda-cloud/monitoring/issues/242"},"#242")),(0,r.kt)("h2",{id:"running-automated-chaos-experiments"},"Running automated Chaos experiments"),(0,r.kt)("p",null,"In order to run automated chaos experiments in our new gke. I had to create a new serviceaccount and rolebindings, such that our Jenkins can access the new Kubernetes cluster and our experiments can delete and create new resources."),(0,r.kt)("h2",{id:"participants"},"Participants"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"@zelldon")))}c.isMDXComponent=!0},9818:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/base-latency-b3584d4828338cc30cd0f98d4e5364b2.png"},3502:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/base-res-6c4945e3aa2f2f1a1b4b45b0196ad365.png"},128:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/base-73443f959dc96d682767e07346c354b3.png"},7840:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/missing-gw-metrics-8a3189d807658f5c0a1b4c0fd4fdfd72.png"},2970:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/missing-io-bcbcfa26798cbc4d03b1ae9cbc0983d0.png"},3687:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-l-disk-11ab26036642262b3c3d1bd47b3dfa48.png"},5985:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-l-general-7fec281ff6544c737c11c77ae6fa092c.png"},4384:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-l-latency-e73d60cffd48e34d391fdaae755d36c1.png"},145:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-l-res-eb60dc64e81a2073b7b541367303b2db.png"},5327:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-l-working-8888402c802b3a2200214226c12f9f43.png"},1370:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-m-disk-9d098bd49e1df8c956d53734500382d0.png"},5543:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-m-general-5f960be92707983d4c2125897f2e2bfd.png"},9392:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-m-latency-0acc9fe1f8065a925d6219e539134d0f.png"},6335:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-m-res-761847f9331f508da2fb49a24b4bcb0f.png"},7706:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-m-working-9634d13df175c735233358b629115470.png"},8148:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-s-disk-59ab7c9655bb2a694991d15312831415.png"},9850:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-s-general-cb2523b958125e7fa9b10c7c12b77d73.png"},9523:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-s-latency-e5f8673c8e3f2224087e77ccf7accdf9.png"},7770:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-s-res-e834f5c4d95bffb7c93f080202bc025a.png"},4558:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/prod-s-working-3ca710d13ef5785cdd18a73c333e4a47.png"},8660:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/status-cbabee80ac866c2fed379253c9dc31d7.png"}}]);