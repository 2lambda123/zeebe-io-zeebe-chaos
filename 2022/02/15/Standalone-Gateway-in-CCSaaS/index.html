<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Blog Atom Feed"><title data-react-helmet="true">Standalone Gateway in CCSaaS | Zeebe Chaos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeebe-io.github.io/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Standalone Gateway in CCSaaS | Zeebe Chaos"><meta data-react-helmet="true" name="description" content="We recently introduced the Zeebe Standalone Gateway in CCSaaS. Today I wanted to do a first simple"><meta data-react-helmet="true" property="og:description" content="We recently introduced the Zeebe Standalone Gateway in CCSaaS. Today I wanted to do a first simple"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-02-15T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/zelldon"><meta data-react-helmet="true" property="article:tag" content="availability"><link data-react-helmet="true" rel="shortcut icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-react-helmet="true" rel="canonical" href="https://zeebe-io.github.io/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS" hreflang="x-default"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.6f65080a.css">
<link rel="preload" href="/zeebe-chaos/assets/js/runtime~main.7190fac4.js" as="script">
<link rel="preload" href="/zeebe-chaos/assets/js/main.b9a5d04f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zeebe-io/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS">Standalone Gateway in CCSaaS</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/02/01/High-Snapshot-Frequency">High Snapshot Frequency</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/01/19/big-variables">Handling of Big Variables</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance">Worker count should not impact performance</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Standalone Gateway in CCSaaS</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-02-15T00:00:00.000Z" itemprop="datePublished">February 15, 2022</time> Â· 4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/zelldon.png" alt="Christopher Zell"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christopher Zell</span></a></div><small class="avatar__subtitle" itemprop="description">Chaos Engineer @ Zeebe</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>We recently introduced the Zeebe Standalone Gateway in CCSaaS. Today I wanted to do a first simple
chaos experiment with the gateway, where we just restart one gateway. </p><p>Ideally in the future we could enable some gateway chaos experiments again, which we currently only support for <a href="https://github.com/zeebe-io/zeebe-chaos/tree/master/chaos-workers/chaos-experiments/helm" target="_blank" rel="noopener noreferrer">helm</a>.</p><p><strong>TL;DR;</strong> Our Camunda Cloud clusters can handle gateway restarts without issues. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="chaos-experiment"></a>Chaos Experiment<a class="hash-link" href="#chaos-experiment" title="Direct link to heading">#</a></h2><p>This experiment is a simple restart / kill pod experiment. We want to verify that our cluster
can still make progress even if a gateway is restarted / killed in between. Currently, we are running two gateway replicas in the CCSaaS. </p><p>In order to start with our experiment we created a new CCSaaS cluster with a <code>Production - S</code> plan, and the latest version (1.3.4).
To run some load on the cluster we used the cloud benchmark deployments, which you can find <a href="https://github.com/camunda-cloud/zeebe/tree/main/benchmarks/setup/cloud-default" target="_blank" rel="noopener noreferrer">here</a>.
The load was rather low with ~ 100 PI/s.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="expected"></a>Expected<a class="hash-link" href="#expected" title="Direct link to heading">#</a></h3><p><em>Hypothesis: When restarting / killing a zeebe standalone gateway we expect only a small
impact on current requests, new requests should be routed to the right gateway and the cluster can
make progress.</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="actual"></a>Actual<a class="hash-link" href="#actual" title="Direct link to heading">#</a></h3><p>After creating the cluster and starting the benchmark we checked the current resource usage, to find a cluster which does most of the work. It looks like that the requests are well distributed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell zell-chaos/ cluster: ultrachaos ns:448f5091-8d15-4c01-a0ee-202437c09d83-zeebe</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ k </span><span class="token function" style="color:#d73a49">top</span><span class="token plain"> pod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                     CPU</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   MEMORY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.      </span></span><span class="token-line" style="color:#393A34"><span class="token plain">zeebe-gateway-6c9f95b557-f2zbf                           294m         407Mi           </span></span><span class="token-line" style="color:#393A34"><span class="token plain">zeebe-gateway-6c9f95b557-gk57z                           202m         396Mi</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We deleted the first pod <code>zeebe-gateway-6c9f95b557-f2zbf</code> and observed the metrics.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[zell zell-chaos/ cluster: ultrachaos ns:448f5091-8d15-4c01-a0ee-202437c09d83-zeebe]$ k delete pod zeebe-gateway-6c9f95b557-f2zbf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod &quot;zeebe-gateway-6c9f95b557-f2zbf&quot; deleted</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can see that a new gateway pod is created quite fast.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[zell zell-chaos/ cluster: ultrachaos ns:448f5091-8d15-4c01-a0ee-202437c09d83-zeebe]$ kgpo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                     READY   STATUS             RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zeebe-gateway-6c9f95b557-flgz6                           0/1     Running            0          16s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zeebe-gateway-6c9f95b557-gk57z                           1/1     Running            0          156m</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As expected we see no high impact due to the restart. </p><p><img src="/zeebe-chaos/assets/images/restart-5fbac0a50fb69d699a0721209d956d9d.png"></p><p>Just out of interest I deleted all gateway pods:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ k delete pod -l app.kubernetes.io/component</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">standalone-gateway</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod </span><span class="token string" style="color:#e3116c">&quot;zeebe-gateway-6c9f95b557-flgz6&quot;</span><span class="token plain"> deleted</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod </span><span class="token string" style="color:#e3116c">&quot;zeebe-gateway-6c9f95b557-gk57z&quot;</span><span class="token plain"> deleted</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can see that the throughput goes almost directly down, but recovers again. It took ~4 min until we
reached the normal state (normal throughput of 100 PI/s) again. But we can also see that it is only a short period
of time, where nothing happens. </p><p><img src="/zeebe-chaos/assets/images/restart2-a5fd3b37472ebf79e5edac7f1ed513e5.png"></p><p>Ideally we would define some anti-affinity on the gateway pods, to reduce the risk of losing all gateways at once.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="result"></a>Result<a class="hash-link" href="#result" title="Direct link to heading">#</a></h2><p>We were able to verify and proof our hypothesis.</p><blockquote><p><em>Hypothesis: When restarting / killing a zeebe standalone gateway we expect only a small
impact on current requests, new requests should be routed to the right gateway and the cluster can
make progress.</em></p></blockquote><p>As we saw above the resources were almost equally used, which is in our normal zeebe benchmarks not the case.
In the benchmarks we use the helm charts and there is no ingress controller enabled,
so we have no good load balancing of the incoming requests.</p><p>The benefit of the standalone gateway now stands out: losing one is not too problematic than one broker with an embedded gateway,
since a broker takes longer to restart and is likely to be an leader for a partition, which will then also cause a leader change.
Furthermore, we can scale the gateways independently. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="found-issues"></a>Found Issues<a class="hash-link" href="#found-issues" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="optimize-resources"></a>Optimize resources<a class="hash-link" href="#optimize-resources" title="Direct link to heading">#</a></h3><p>During experiment with the CCSaaS cluster I observed that the Optimize importer was crashlooping due to this load (PI 100/s).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell zell-chaos/ cluster: ultrachaos ns:448f5091-8d15-4c01-a0ee-202437c09d83-zeebe</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ kgpo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                     READY   STATUS             RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">optimize-deployment-importer-archiver-65679b6449-pb7kz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     CrashLoopBackOff   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">          128m</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Checking the pod shows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">    State:          Waiting</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Reason:       CrashLoopBackOff</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Last State:     Terminated</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Reason:       Error</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Exit Code:    </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Tue, </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> Feb </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:25:36 +0100</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Finished:     Tue, </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> Feb </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:26:33 +0100</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ready:          False</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Checking the logs we can see that it runs continuously out of memory.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Zellï¿¼  </span><span class="token number" style="color:#36acaa">13</span><span class="token plain"> minutes ago</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:32:48.493 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ZeebeImportScheduler-1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WARN  org.elasticsearch.client.RestClient - request </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">POST http://elasticsearch:9200/zeebe-record-process-instance/_search?routing</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">typed_keys</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">max_concurrent_shard_requests</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">ignore_unavailable</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">expand_wildcards</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">open</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">allow_no_indices</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">ignore_throttled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">request_cache</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">search_type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">query_then_fetch</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">batched_reduce_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">512</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">ccs_minimize_roundtrips</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> returned </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> warnings: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">299</span><span class="token plain"> Elasticsearch-7.16.2-2b937c44140b6559905130a8650c64dbd0879cfb </span><span class="token string" style="color:#e3116c">&quot;[ignore_throttled] parameter is deprecated because frozen indices have been deprecated. Consider cold or frozen tiers in place of frozen indices.&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:32:49.104 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ImportJobExecutor-pool-ZeebeProcessInstanceImportService-0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> WARN  org.elasticsearch.client.RestClient - request </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">HEAD http://elasticsearch:9200/optimize-process-instance-benchmark?ignore_throttled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">ignore_unavailable</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">expand_wildcards</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">open%2Cclosed</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">allow_no_indices</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> returned </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> warnings: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">299</span><span class="token plain"> Elasticsearch-7.16.2-2b937c44140b6559905130a8650c64dbd0879cfb </span><span class="token string" style="color:#e3116c">&quot;[ignore_throttled] parameter is deprecated because frozen indices have been deprecated. Consider cold or frozen tiers in place of frozen indices.&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">java.lang.OutOfMemoryError: Java heap space</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Dumping heap to java_pid8.hprof </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Heap dump </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> created </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">611503401</span><span class="token plain"> bytes </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.070</span><span class="token plain"> secs</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Terminating due to java.lang.OutOfMemoryError: Java heap space</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="gateway-metrics"></a>Gateway metrics<a class="hash-link" href="#gateway-metrics" title="Direct link to heading">#</a></h3><p>It looks like that in our latest ccsm helm charts, we no longer export the gateway metrics which we should fix.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="gateway-anti-affinity"></a>Gateway Anti-affinity<a class="hash-link" href="#gateway-anti-affinity" title="Direct link to heading">#</a></h3><p>Currently, we have no anti-affinity defined for the gateway, which could cause on preemption to take down all gateways.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/zeebe-chaos/tags/availability">availability</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2022-02-15-Standalone-Gateway-in-CCSaaS/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zeebe-chaos/2022/02/01/High-Snapshot-Frequency"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">High Snapshot Frequency Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chaos-experiment" class="table-of-contents__link">Chaos Experiment</a><ul><li><a href="#expected" class="table-of-contents__link">Expected</a></li><li><a href="#actual" class="table-of-contents__link">Actual</a></li></ul></li><li><a href="#result" class="table-of-contents__link">Result</a></li><li><a href="#found-issues" class="table-of-contents__link">Found Issues</a><ul><li><a href="#optimize-resources" class="table-of-contents__link">Optimize resources</a></li><li><a href="#gateway-metrics" class="table-of-contents__link">Gateway metrics</a></li><li><a href="#gateway-anti-affinity" class="table-of-contents__link">Gateway Anti-affinity</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zeebe-io/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zeebe-chaos/assets/js/runtime~main.7190fac4.js"></script>
<script src="/zeebe-chaos/assets/js/main.b9a5d04f.js"></script>
</body>
</html>