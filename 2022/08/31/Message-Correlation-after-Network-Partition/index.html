<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Blog Atom Feed"><title data-react-helmet="true">Message Correlation after Network Partition | Zeebe Chaos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeebe-io.github.io/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Message Correlation after Network Partition | Zeebe Chaos"><meta data-react-helmet="true" name="description" content="In the last weeks, we made several changes in our core components, we introduce some new abstractions, and changed how we communicate between partitions."><meta data-react-helmet="true" property="og:description" content="In the last weeks, we made several changes in our core components, we introduce some new abstractions, and changed how we communicate between partitions."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-08-31T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/zelldon"><meta data-react-helmet="true" property="article:tag" content="availability"><link data-react-helmet="true" rel="shortcut icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-react-helmet="true" rel="canonical" href="https://zeebe-io.github.io/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition" hreflang="x-default"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.878b0132.css">
<link rel="preload" href="/zeebe-chaos/assets/js/runtime~main.4310f2df.js" as="script">
<link rel="preload" href="/zeebe-chaos/assets/js/main.23f02ddb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zeebe-io/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/zeebe-chaos/2022/08/31/Message-Correlation-after-Network-Partition">Message Correlation after Network Partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/08/02/deployment-distribution">Bring Deployment distribution experiment back</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/02/15/Standalone-Gateway-in-CCSaaS">Standalone Gateway in CCSaaS</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/02/01/High-Snapshot-Frequency">High Snapshot Frequency</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2022/01/19/big-variables">Handling of Big Variables</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance">Worker count should not impact performance</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Message Correlation after Network Partition</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-08-31T00:00:00.000Z" itemprop="datePublished">August 31, 2022</time> Â· 10 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/zelldon.png" alt="Christopher Zell"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christopher Zell</span></a></div><small class="avatar__subtitle" itemprop="description">Chaos Engineer @ Zeebe</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In the last weeks, we made several changes in our core components, we introduce some new abstractions, and changed how we communicate between partitions.</p><p>Due to these changes, we thought it might make sense to run some more chaos experiments in that direction and area since our benchmarks also recently found some interesting edge cases.</p><p>Today we experimented with Message Correlation and what happens when a network partition disturbs the correlation process.</p><p><strong>TL;DR;</strong> The experiment was partially successful (after retry), we were able to publish messages during a network partition that have been correlated after the network partition. We need to verify whether we can also publish messages before a network partition and during the partition create the related instances.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="chaos-experiment"></a>Chaos Experiment<a class="hash-link" href="#chaos-experiment" title="Direct link to heading">#</a></h2><p>The experiment is related to our previously described <a href="/zeebe-chaos/2022/08/02/deployment-distribution">deployment distribution experiment</a>.</p><p>When a user/client publishes a message, the message will be sent to a certain partition, based on the correlation key. There is some calculation going on related to the hashcode and the partition count.
This calculation is deterministic in order to find later the message again if we reach a message catch event.</p><p>A message can specify a time-to-live (TTL), <a href="https://docs.camunda.io/docs/components/concepts/messages/#message-buffering" target="_blank" rel="noopener noreferrer">which allows buffering that message</a>. If later a process instance is created and the TTL is not exceeded the message can be still correlated. The creation of process instances
happens round-robin on the existing/available partitions (this is controlled by the gateway). When a process instance is created and reaches a message catch event it will be based on the correlation key search for a message on the expected partition. <em>Actually this happens based on subscriptions, for more details see the <a href="https://docs.camunda.io/docs/components/concepts/messages/#message-subscriptions" target="_blank" rel="noopener noreferrer">docs</a> or the <a href="https://github.com/zeebe-io/enhancements/blob/master/ZEP004-wf-stream-processing.md#message-intermediate-catch-event" target="_blank" rel="noopener noreferrer">ZEP-4</a>.</em> If the message still exists (TTL didn&#x27;t expire) and this message <a href="https://docs.camunda.io/docs/components/concepts/messages/#message-cardinality" target="_blank" rel="noopener noreferrer">wasn&#x27;t already correlated to the same process definition</a> then it will be correlated.</p><p>Since both partitions can be on different leader nodes this requires some network communication, which can be interrupted/disturbed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="expected"></a>Expected<a class="hash-link" href="#expected" title="Direct link to heading">#</a></h3><p>We expect that if the network between the partition where the message was published and where the process instance was created is interrupted that no message correlation happens. But after the network recovers, we expect further that the message will be correlated and the process instance can continue.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="actual"></a>Actual<a class="hash-link" href="#actual" title="Direct link to heading">#</a></h3><p>As a setup, I installed our benchmarks, with Operate enabled.
This allows us to also view the details in Operate.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">diff</span><span class="token plain"> zeebe-values.yaml </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/default/zeebe-values.yaml </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5</span><span class="token plain">,8d4</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">   identity:</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">     auth:</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">       enabled: </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">28c24</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">   containerSecurityContext:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   podSecurityContext:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">139c135</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">   enabled: </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   enabled: </span><span class="token boolean" style="color:#36acaa">false</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>During the experiment, it turned out that the <code>podSecurityContext</code> is outdated.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="experiment-description"></a>Experiment Description<a class="hash-link" href="#experiment-description" title="Direct link to heading">#</a></h4><p>Since we want to automate this experiment soon, or later I thought it would be a good idea to use the <a href="https://docs.camunda.io/docs/components/concepts/process-instance-creation/#create-and-await-results" target="_blank" rel="noopener noreferrer">create process instance with result</a>. We would start the following process:</p><p><img alt="msg-catch" src="/zeebe-chaos/assets/images/msg-catch-dba2526317c719b66db25ef1dfaff2a4.png"></p><p>Before we start the process we need to publish the message to a certain partition and create a network partition between two partitions. After that, we can create the PI and verify that the message correlation shouldn&#x27;t happen. Afterward, we would delete the network partition and verify that the process instance is completed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="details"></a>Details<a class="hash-link" href="#details" title="Direct link to heading">#</a></h4><p>To make the experiment easier to reproduce and allow us to experiment in different directions later as well I extend our new chaos cli (zbchaos), which I created during the last hack days. I will write a separate blog post about this tool soon.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="message-publish"></a>Message Publish<a class="hash-link" href="#message-publish" title="Direct link to heading">#</a></h5><p>I added a new feature (<a href="https://github.com/zeebe-io/zeebe-chaos/pull/166" target="_blank" rel="noopener noreferrer">PR #166</a>) that allows us to publish a message to a specific partition:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos publish message -v --partitionId 3</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created port forwarding tunnel</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Send message &#x27;msg&#x27;, with correaltion key &#x27;2&#x27; (ASCII: 50) </span></span><span class="token-line" style="color:#393A34"><span class="token plain">Message was sent and returned key 6755399441055796, which corresponds to partition: 3</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="extend-steady-state-verification"></a>Extend Steady-state verification<a class="hash-link" href="#extend-steady-state-verification" title="Direct link to heading">#</a></h5><p>For the steady-state verification, multiple enhancements have been added.</p><ol><li>Previously the <code>zbchaos</code> didn&#x27;t allow us to create instances of specific models, which is now added as new feature (<a href="https://github.com/zeebe-io/zeebe-chaos/pull/167" target="_blank" rel="noopener noreferrer">PR #167</a>).</li><li>In order to await the process instance completion a new flag was added <code>--awaitResult</code>, which allows us to await the PI completeness.</li><li>To make sure that our message can be correlated we have to set the right correlationKey/value. This means we need to create instances with certain variables, which is now possible as well (<code>--variables</code>).</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos verify steady-state -h</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Verifies the steady state of the Zeebe system.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">A process model will be deployed and process instances are created </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> the required partition is reached.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  zbchaos verify steady-state </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Flags:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --awaitResult               Specify whether the completion of the created process instance should be awaited.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h, --help                      </span><span class="token builtin class-name">help</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> steady-state</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --partitionId int           Specify the </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> of the partition </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --processModelPath string   Specify the path to a BPMN process model, </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> should be deployed and an instance should be created of.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      --variables string          Specify the variables </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the process instance. Expect json string.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Global Flags:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v, --verbose   verbose output</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="execution-of-the-experiment"></a>Execution of the Experiment<a class="hash-link" href="#execution-of-the-experiment" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$./zbchaos verify readiness -v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">All Zeebe nodes are running.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After checking the readiness we can check what the current topology is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos topology</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Node      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">Partition </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">Partition </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">Partition </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LEADER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LEADER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LEADER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can see that the leaders are well distributed. I pick partition 3 as our message publish partition, and partition 1 as our partition for the process instance. Since we can&#x27;t control really the round-robin mechanism, we need to create multiple messages and multiple process instances (for each partition). During our experiment, we will only look at the instance on partition one.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos publish message -v --partitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created port forwarding tunnel</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Send message </span><span class="token string" style="color:#e3116c">&#x27;msg&#x27;</span><span class="token plain">, with correaltion key </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ASCII: </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">Message was sent and returned key </span><span class="token number" style="color:#36acaa">6755399441055745</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> corresponds to partition: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell go-chaos/ cluster: zeebe-cluster ns:zell-chaos</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ ./zbchaos publish message -v --partitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created port forwarding tunnel</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Send message </span><span class="token string" style="color:#e3116c">&#x27;msg&#x27;</span><span class="token plain">, with correaltion key </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ASCII: </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">Message was sent and returned key </span><span class="token number" style="color:#36acaa">6755399441055746</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> corresponds to partition: </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell go-chaos/ cluster: zeebe-cluster ns:zell-chaos</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ ./zbchaos publish message -v --partitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created port forwarding tunnel</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Send message </span><span class="token string" style="color:#e3116c">&#x27;msg&#x27;</span><span class="token plain">, with correaltion key </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ASCII: </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">Message was sent and returned key </span><span class="token number" style="color:#36acaa">6755399441055747</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> corresponds to partition: </span><span class="token number" style="color:#36acaa">3</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Creating the network partition:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos disconnect brokers --broker1PartitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> --broker1Role LEADER --broker2PartitionId </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --broker2Role LEADER -v</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created port forwarding tunnel</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Found Broker zell-chaos-zeebe-2 as LEADER </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> partition </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Found Broker zell-chaos-zeebe-0 as LEADER </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> partition </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;apt&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-qq&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;update&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> on pod zell-chaos-zeebe-2</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Disconnect zell-chaos-zeebe-2 from zell-chaos-zeebe-0</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Disconnect zell-chaos-zeebe-0 from zell-chaos-zeebe-2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Creating the process instance and await the result:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos verify steady-state --awaitResult --partitionId </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --processModelPath </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/msg-catch.bpmn --variables </span><span class="token string" style="color:#e3116c">&#x27;{&quot;key&quot;:&quot;2&quot;}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Unfortunately, I missed the verbose flag so we can&#x27;t really see the output. But if failed later with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">Encountered an error during process instance creation. Error: rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeadlineExceeded desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Time out between gateway and broker: Request ProtocolRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">422</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">subject</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">command-api-1, </span><span class="token assign-left variable" style="color:#36acaa">sender</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.20.4:26502, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">153</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">hash</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1559826040</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to zell-chaos-zeebe-2.zell-chaos-zeebe.zell-chaos.svc:26501 timed out </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> PT15S</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Encountered an error during process instance creation. Error: rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeadlineExceeded desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Time out between gateway and broker: Request ProtocolRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">441</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">subject</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">command-api-2, </span><span class="token assign-left variable" style="color:#36acaa">sender</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.20.4:26502, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">153</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">hash</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">-1786651527</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to zell-chaos-zeebe-1.zell-chaos-zeebe.zell-chaos.svc:26501 timed out </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> PT15S</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Encountered an error during process instance creation. Error: rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NotFound desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Command </span><span class="token string" style="color:#e3116c">&#x27;CREATE_WITH_AWAITING_RESULT&#x27;</span><span class="token plain"> rejected with code </span><span class="token string" style="color:#e3116c">&#x27;NOT_FOUND&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> Expected to </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> process definition with key </span><span class="token string" style="color:#e3116c">&#x27;2251799813685249&#x27;</span><span class="token plain">, but none found</span></span><span class="token-line" style="color:#393A34"><span class="token plain">panic: Expected to create process instance on partition </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, but timed out after 30s.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">goroutine </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">running</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/zeebe-io/zeebe-chaos/go-chaos/cmd.glob</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">func10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x247f740?, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">0x1758c60?, 0x7?, 0x7?</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/src/github.com/zeebe-io/zeebe-chaos/go-chaos/cmd/verify.go:97 +0x1c5</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/spf13/cobra.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*Command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x247f740, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">0xc000426540, 0x7, 0x7</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:876 +0x67b</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/spf13/cobra.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*Command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.ExecuteC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x24808c0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:990 +0x3bd</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/spf13/cobra.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*Command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.Execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:918</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/zeebe-io/zeebe-chaos/go-chaos/cmd.Execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/src/github.com/zeebe-io/zeebe-chaos/go-chaos/cmd/root.go:61 +0x25</span></span><span class="token-line" style="color:#393A34"><span class="token plain">main.main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/src/github.com/zeebe-io/zeebe-chaos/go-chaos/main.go:8 +0x17</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>I retried it:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos verify steady-state --awaitResult --partitionId </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --processModelPath </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/msg-catch.bpmn --variables </span><span class="token string" style="color:#e3116c">&#x27;{&quot;key&quot;:&quot;2&quot;}&#x27;</span><span class="token plain"> -v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created port forwarding tunnel</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Deploy </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/msg-catch.bpmn </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size: </span><span class="token number" style="color:#36acaa">2980</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Deployed process model </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/msg-catch.bpmn successful with key </span><span class="token number" style="color:#36acaa">2251799813685249</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Create process instance with defition key </span><span class="token number" style="color:#36acaa">2251799813685249</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">variables: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;key&quot;:&quot;2&quot;}&#x27;</span><span class="token plain">, awaitResult: true</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Encountered an error during process instance creation. Error: rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeadlineExceeded desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Time out between gateway and broker: Request ProtocolRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">509</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">subject</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">command-api-1, </span><span class="token assign-left variable" style="color:#36acaa">sender</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.20.4:26502, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">153</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">hash</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1559826040</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to zell-chaos-zeebe-2.zell-chaos-zeebe.zell-chaos.svc:26501 timed out </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> PT15S</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Create process instance with defition key </span><span class="token number" style="color:#36acaa">2251799813685249</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">variables: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;key&quot;:&quot;2&quot;}&#x27;</span><span class="token plain">, awaitResult: true</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Encountered an error during process instance creation. Error: rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeadlineExceeded desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Time out between gateway and broker: Request ProtocolRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">530</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">subject</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">command-api-2, </span><span class="token assign-left variable" style="color:#36acaa">sender</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.20.4:26502, </span><span class="token assign-left variable" style="color:#36acaa">payload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">153</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">hash</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">-1786651527</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> to zell-chaos-zeebe-1.zell-chaos-zeebe.zell-chaos.svc:26501 timed out </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> PT14.999S</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Create process instance with defition key </span><span class="token number" style="color:#36acaa">2251799813685249</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">variables: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;key&quot;:&quot;2&quot;}&#x27;</span><span class="token plain">, awaitResult: true</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Encountered an error during process instance creation. Error: rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NotFound desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Command </span><span class="token string" style="color:#e3116c">&#x27;CREATE_WITH_AWAITING_RESULT&#x27;</span><span class="token plain"> rejected with code </span><span class="token string" style="color:#e3116c">&#x27;NOT_FOUND&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> Expected to </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> process definition with key </span><span class="token string" style="color:#e3116c">&#x27;2251799813685249&#x27;</span><span class="token plain">, but none found</span></span><span class="token-line" style="color:#393A34"><span class="token plain">panic: Expected to create process instance on partition </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, but timed out after 30s.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">goroutine </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">running</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/zeebe-io/zeebe-chaos/go-chaos/cmd.glob</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">func10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x247f740?, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">0x1758c60?, 0x8?, 0x8?</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/src/github.com/zeebe-io/zeebe-chaos/go-chaos/cmd/verify.go:97 +0x1c5</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/spf13/cobra.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*Command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x247f740, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">0xc00007e500, 0x8, 0x8</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:876 +0x67b</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/spf13/cobra.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*Command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.ExecuteC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x24808c0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:990 +0x3bd</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/spf13/cobra.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*Command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.Execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/pkg/mod/github.com/spf13/cobra@v1.5.0/command.go:918</span></span><span class="token-line" style="color:#393A34"><span class="token plain">github.com/zeebe-io/zeebe-chaos/go-chaos/cmd.Execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/src/github.com/zeebe-io/zeebe-chaos/go-chaos/cmd/root.go:61 +0x25</span></span><span class="token-line" style="color:#393A34"><span class="token plain">main.main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/zell/goPath/src/github.com/zeebe-io/zeebe-chaos/go-chaos/main.go:8 +0x17</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>And got a similar exception. Taking a look at Operate we can see that process instances are created. It is likely that the await timed out since the message hasn&#x27;t been correlated but the returned error is a bit unclear. Interesting is that on partition two the message is also not correlated.</p><p><img alt="operate" src="/zeebe-chaos/assets/images/operate-efd0c9d98a1666f44bf235ba5bf4cdf2.png"></p><p>Removing the network partition:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos connect brokers -v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connecting to zell-chaos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;command -v ip&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> on pod zell-chaos-zeebe-0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/ip</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ip route | grep -m 1 unreachable&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> on pod zell-chaos-zeebe-0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ip route del unreachable 10.0.17.8&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> on pod zell-chaos-zeebe-0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected zell-chaos-zeebe-0 again, removed unreachable routes.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;command -v ip&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> on pod zell-chaos-zeebe-1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Error on connection Broker: zell-chaos-zeebe-1. Error: Execution exited with </span><span class="token builtin class-name">exit</span><span class="token plain"> code </span><span class="token number" style="color:#36acaa">127</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Command not found</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">. It is likely that the broker was not disconnected or restarted </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> between.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Execute </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sh&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;command -v ip&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> on pod zell-chaos-zeebe-2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Error on connection Broker: zell-chaos-zeebe-2. Error: Execution exited with </span><span class="token builtin class-name">exit</span><span class="token plain"> code </span><span class="token number" style="color:#36acaa">127</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Command not found</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">. It is likely that the broker was not disconnected or restarted </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> between.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It looks like the Broker-2 was restarted in between, which is really the case if we check the <code>kubectl get pods</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">[zell go-chaos/ cluster: zeebe-cluster ns:zell-chaos]$ kgpo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS      RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">camunda-platform-curator-27698835-pwdjh     0/1     Completed   0          9m20s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">elasticsearch-master-0                      1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">elasticsearch-master-1                      1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">elasticsearch-master-2                      1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-operate-64bbc6794d-vqtnc         1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-zeebe-0                          1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-zeebe-1                          1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-zeebe-2                          1/1     Running     0          2m48s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-zeebe-gateway-795f87fd64-c9mf4   1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-zeebe-gateway-795f87fd64-h5d9c   1/1     Running     0          12m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">zell-chaos-zeebe-gateway-795f87fd64-nlr5v   1/1     Running     0          12m</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The topology has also completely changed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./zbchaos topology</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Node      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">Partition </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">Partition </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">Partition </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LEADER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LEADER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LEADER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FOLLOWER </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEALTHY</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After connecting again the instances haven&#x27;t been executed. My guess is that the TTL was already reached.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="rerun"></a>Rerun<a class="hash-link" href="#rerun" title="Direct link to heading">#</a></h5><p>I will disconnect again partitions one and three and publish a message to partition three. Afterward I will connect them again and see whether the message is correlated.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos disconnect brokers --broker1PartitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> --broker1Role LEADER --broker2PartitionId </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --broker2Role LEADER -v</span></span><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos publish message -v --partitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos publish message -v --partitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos publish message -v --partitionId </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">./zbchaos connect brokers -v</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Take a look at Operate again:</p><p><img alt="operate2" src="/zeebe-chaos/assets/images/operate2-c96a932956d4207bff7ce70f78cb7544.png"></p><p>We can see that the experiment was successful, and the message has been correlated even if they are published during a network partition. ðŸŽ‰</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="found-bugs"></a>Found Bugs<a class="hash-link" href="#found-bugs" title="Direct link to heading">#</a></h2><ul><li>I learned that the go zeebe client, doesn&#x27;t set a default TTL which was interesting to find out (and somehow unexpected).</li><li>The zbchaos uses always the same port for connecting to the kubernetes and zeebe cluster, which makes it impossible to run multiple commands. We should use random ports to make this possible.</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/zeebe-chaos/tags/availability">availability</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2022-08-31-Message-Correlation-after-Network-Partition/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zeebe-chaos/2022/08/02/deployment-distribution"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Bring Deployment distribution experiment back Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chaos-experiment" class="table-of-contents__link">Chaos Experiment</a><ul><li><a href="#expected" class="table-of-contents__link">Expected</a></li><li><a href="#actual" class="table-of-contents__link">Actual</a></li></ul></li><li><a href="#found-bugs" class="table-of-contents__link">Found Bugs</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zeebe-io/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zeebe-chaos/assets/js/runtime~main.4310f2df.js"></script>
<script src="/zeebe-chaos/assets/js/main.23f02ddb.js"></script>
</body>
</html>