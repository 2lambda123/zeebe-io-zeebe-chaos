<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Blog Atom Feed"><title data-react-helmet="true">Time travel Experiment | Zeebe Chaos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeebe-io.github.io/zeebe-chaos/2021/05/25/Reset-Clock"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Time travel Experiment | Zeebe Chaos"><meta data-react-helmet="true" name="description" content="Recently we run a Game day where a lot of messages with high TTL have been stored in the state. This was based on an earlier incident, which we had seen in production. One suggested approach to resolve that incident was to increase the time, such that all messages are removed from the state. This and the fact that summer and winter time shifts can cause in other systems evil bugs, we wanted to find out how our system can handle time shifts. Phil joined me as participant and observer. There was a related issue which covers this topic as well, zeebe-chaos#3."><meta data-react-helmet="true" property="og:description" content="Recently we run a Game day where a lot of messages with high TTL have been stored in the state. This was based on an earlier incident, which we had seen in production. One suggested approach to resolve that incident was to increase the time, such that all messages are removed from the state. This and the fact that summer and winter time shifts can cause in other systems evil bugs, we wanted to find out how our system can handle time shifts. Phil joined me as participant and observer. There was a related issue which covers this topic as well, zeebe-chaos#3."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-05-25T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/zelldon"><meta data-react-helmet="true" property="article:tag" content="data"><link data-react-helmet="true" rel="shortcut icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-react-helmet="true" rel="canonical" href="https://zeebe-io.github.io/zeebe-chaos/2021/05/25/Reset-Clock"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2021/05/25/Reset-Clock" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2021/05/25/Reset-Clock" hreflang="x-default"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.473f1099.css">
<link rel="preload" href="/zeebe-chaos/assets/js/runtime~main.b018d4c1.js" as="script">
<link rel="preload" href="/zeebe-chaos/assets/js/main.8955be73.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zeebe-io/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Time travel Experiment</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-05-25T00:00:00.000Z" itemprop="datePublished">May 25, 2021</time> · 9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/zelldon.png" alt="Christopher Zell"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christopher Zell</span></a></div><small class="avatar__subtitle" itemprop="description">Chaos Engineer @ Zeebe</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://confluence.camunda.com/display/ZEEBE/Game+Day+18.05.2021" target="_blank" rel="noopener noreferrer">Recently we run a Game day</a> where a lot of messages with high TTL have been stored in the state. This was based on an earlier incident, which we had seen in production. One suggested approach to resolve that incident was to increase the time, such that all messages are removed from the state. This and the fact that summer and winter time shifts can cause in other systems evil bugs, we wanted to find out how our system can handle time shifts. <a href="https://github.com/saig0" target="_blank" rel="noopener noreferrer">Phil</a> joined me as participant and observer. There was a related issue which covers this topic as well, <a href="https://github.com/zeebe-io/zeebe-chaos/issues/3" target="_blank" rel="noopener noreferrer">zeebe-chaos#3</a>.</p><p><strong>TL;DR;</strong> Zeebe is able to handle time shifts back and forth, without observable issues. Operate seems to dislike it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="chaos-experiment"></a>Chaos Experiment<a class="hash-link" href="#chaos-experiment" title="Direct link to heading">#</a></h2><p>As part of the experiment we had to define what we expect, if we change the time. In order to keep it simple we decided to experiment with one-hour move forward and backwards. We wanted to run the experiment first against our normal benchmark cluster and afterwards against a Production - S Cluster on INT. Furthermore, we decided to test the time shift only on leaders, for now.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="expected"></a>Expected<a class="hash-link" href="#expected" title="Direct link to heading">#</a></h3><p><em>If we move the time one-hour forward we expect:</em></p><ul><li>in general, timers should be triggered (snapshot, message TTL, job timeouts, timers etc.)</li><li>the system should operate normal, means zeebe and operate should be healthy and continue working</li></ul><p><em>If we move the time one-hour backwards we expect:</em></p><ul><li>timers should not be triggered, until the deadline + 1 hour is reached</li><li>the system should operate normal</li><li>with operate we were not sure whether it has issues with exported records on the same time</li></ul><p>Before we started, with running the experiment, we had to find out how we can change the time in a docker container.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="changing-time"></a>Changing Time<a class="hash-link" href="#changing-time" title="Direct link to heading">#</a></h3><p><strong>*Note:</strong> If you&#x27;re not interested in how we change the time you can jump to the <a href="#experiment-on-benchmark-cluster">next section</a>*</p><p>If you search for it, you find quite quickly answers in how to change the time in a docker container. For example, we found this <a href="https://serverfault.com/a/898842/283059" target="_blank" rel="noopener noreferrer">answer</a>, which was quite useful.</p><p>In order to apply this, we first need to make sure that we have the right <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank" rel="noopener noreferrer">linux capabilities</a> to change the system time. For that we need the <code>SYS_TIME</code> capability. In our benchmarks this is quite easy to do, we just need to change <a href="https://github.com/camunda-cloud/zeebe/blob/develop/benchmarks/setup/default/zeebe-values.yaml#L16" target="_blank" rel="noopener noreferrer">this line</a> and add <code>SYS_TIME</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">podSecurityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;NET_ADMIN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SYS_TIME&quot;</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After changing this, we can set the time via <a href="https://man7.org/linux/man-pages/man1/date.1.html" target="_blank" rel="noopener noreferrer"><code>date -s</code></a>. Since we were not sure whether this really works for our java process, we started a <a href="https://docs.oracle.com/javase/9/tools/jshell.htm#JSWOR-GUID-C337353B-074A-431C-993F-60C226163F00" target="_blank" rel="noopener noreferrer"><code>jshell</code></a> to verify that. <em>Note:</em> the jshell is only available if you use an container image with jdk. This is available, if you build your own zeebe docker image via <a href="https://github.com/camunda-cloud/zeebe/blob/develop/createBenchmark.sh" target="_blank" rel="noopener noreferrer">zeebe/createBenchmark.sh</a>.</p><p>Changing the time:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-phil-chaos-zeebe-1:/usr/local/zeebe# date</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue May 25 10:29:33 UTC 2021</span></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-phil-chaos-zeebe-1:/usr/local/zeebe# date +%T -s &quot;09:29:00&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">09:29:00</span></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-phil-chaos-zeebe-1:/usr/local/zeebe# date</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue May 25 09:29:01 UTC 2021</span></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zell-phil-chaos-zeebe-1:/usr/local/zeebe# jshell</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Picked up JAVA_TOOL_OPTIONS: -XX:MaxRAMPercentage=25.0 -XX:+ExitOnOutOfMemoryError -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/usr/local/zeebe/data -XX:ErrorFile=/usr/local/zeebe/data/zeebe_error%p.log -Xlog:gc*:file=/usr/local/zeebe/data/gc.log:time:filecount=7,filesize=8M</span></span><span class="token-line" style="color:#393A34"><span class="token plain">May 25, 2021 9:29:03 AM java.util.prefs.FileSystemPreferences$1 run</span></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Created user preferences directory.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Welcome to JShell -- Version 11.0.11</span></span><span class="token-line" style="color:#393A34"><span class="token plain">|  For an introduction type: /help intro</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">jshell&gt; new Date()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$1 ==&gt; Tue May 25 09:29:08 UTC 2021</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After we found out how we can actually change the time we moved forward and run the described chaos experiment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="experiment-on-benchmark-cluster"></a>Experiment on Benchmark Cluster<a class="hash-link" href="#experiment-on-benchmark-cluster" title="Direct link to heading">#</a></h3><p>As usual, we have set up a normal benchmark cluster with three nodes, three partitions and replication factor three. We run 200 PI/s and 12 workers against that cluster.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="move-time-forward"></a>Move Time Forward<a class="hash-link" href="#move-time-forward" title="Direct link to heading">#</a></h4><p>After setting up the cluster we had to find out who is the Leader and picked the one who is Leader for the most of the partitions.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ k </span><span class="token builtin class-name">exec</span><span class="token plain"> -it zell-phil-chaos-zeebe-0 -- zbctl status --insecure</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Brokers:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Broker </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> - zell-phil-chaos-zeebe-0.zell-phil-chaos-zeebe.zell-phil-chaos.svc.cluster.local:26501</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Version: </span><span class="token number" style="color:#36acaa">1.1</span><span class="token plain">.0-SNAPSHOT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Partition </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> Follower, Healthy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Partition </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> Leader, Healthy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Partition </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> Leader, Healthy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>On Broker 0 we increased the time by one hour.</strong> After doing this we observed the metrics, but we haven&#x27;t noticed any issues. We verified logs in stackdriver, but no errors were thrown.
<img alt="inc-1-hour-general" src="/zeebe-chaos/assets/images/inc-1-hour-general-e76624008b7d3eb96d0c869f5fe6c1af.png"></p><p>We noticed, looking at the metrics, that the snapshot was triggered when we moved the time forward. This was what we actually expected. Plus also new scheduled snapshot have been triggered and created.
<img alt="inc-1-hour-snapshot" src="/zeebe-chaos/assets/images/inc-1-hour-snapshot-bc4a81c9e31d5fcba49d7a916f3e8e52.png"></p><p>On the elastic exporter we can see that flushing has happened earlier than usual, because we increased the time. This was also expected.<br>
<img alt="inc-1-hour-export" src="/zeebe-chaos/assets/images/inc-1-hour-export-f6f3d566842ac4cf305ceb7d010b5c59.png"></p><p><strong>Experiment succeeded</strong> ✔️</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="move-time-backwards"></a>Move Time Backwards<a class="hash-link" href="#move-time-backwards" title="Direct link to heading">#</a></h4><p>In order to run the experiment again, with moving the timer backwards, we set up a new benchmark cluster. This time we run the experiment on Broker 1, since he was the leader of the most partitions.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Broker 1 - zell-phil-chaos-zeebe-1.zell-phil-chaos-zeebe.zell-phil-chaos.svc.cluster.local:26501</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version: 1.1.0-SNAPSHOT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Partition 1 : Follower, Healthy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Partition 2 : Leader, Healthy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Partition 3 : Leader, Healthy</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>No general issues have been detected, as expected no longer snapshots were taken.
<img alt="dec-1-hour-general" src="/zeebe-chaos/assets/images/dec-1-hour-general-d20ebf3b510bacc0bae5a2533d7e3f1d.png"></p><p>We have run the benchmark for a bit longer, to see whether the snapshot will be triggered later, which was indeed the case.
<img alt="dec-1-hour-snapshot-later" src="/zeebe-chaos/assets/images/dec-1-hour-snapshot-later-9a9aa6dd1f828ccc63e0d67370765945.png"></p><p>We could also observe how the journal segments increased until we took the next snapshot.
<img alt="dec-1-hour-snapshot-segments" src="/zeebe-chaos/assets/images/dec-1-hour-snapshot-segments-342d9ead5f0535ae7a52b5d0e7f8fe89.png"></p><p><strong>Experiment succeeded</strong> ✔️</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="experiment-on-int"></a>Experiment on INT<a class="hash-link" href="#experiment-on-int" title="Direct link to heading">#</a></h3><p>After running the experiment against our benchmark clusters we were confident to run it against a Production S cluster on INT.
We have set up a Production S cluster in our chaos cluster and run the <a href="https://github.com/camunda-cloud/zeebe/blob/develop/benchmarks/setup/newCloudBenchmark.sh" target="_blank" rel="noopener noreferrer">cloud benchmark</a> against it. It starts starter and worker against that Production S cluster, turned out not with the same load (luckily this doesn&#x27;t matter for this experiment). The starter and workers are deployed in the Zeebe Team gke cluster.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="how-to-change-the-time-on-int"></a>How to change the time on INT<a class="hash-link" href="#how-to-change-the-time-on-int" title="Direct link to heading">#</a></h4><p>On INT, it is not that simple to get the <code>SYS_TIME</code> capability, which we need to change the time. Luckily we already have experience, with getting the necessary capability we need to have.
On a previous chaos day we have added <code>NET_ADMIN</code> capability to a running zeebe container in order to experiment with network partitioning, you can read about that <a href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">here</a>.</p><p>The following patch adds the <code>SYS_TIME</code> cap to our linux container.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;zeebe&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">capabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">add</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SYS_TIME&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following script applies the patch to our Zeebe cluster.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -euo pipefail</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">scriptPath</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable builtin class-name" style="color:#36acaa">cd</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$(</span><span class="token variable string variable function" style="color:#d73a49">dirname</span><span class="token variable string variable" style="color:#36acaa"> </span><span class="token variable string variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable string variable" style="color:#36acaa">${</span><span class="token variable string variable string variable environment constant" style="color:#36acaa">BASH_SOURCE</span><span class="token variable string variable string variable punctuation" style="color:#393A34">[</span><span class="token variable string variable string variable" style="color:#36acaa">0</span><span class="token variable string variable string variable punctuation" style="color:#393A34">]</span><span class="token variable string variable string variable" style="color:#36acaa">}</span><span class="token variable string variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">)</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa"> -P </span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> utils.sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getNamespace</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CLUSTERID</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace</span><span class="token variable operator" style="color:#393A34">%</span><span class="token variable" style="color:#36acaa">-zeebe}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch zb </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$CLUSTERID</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> --type merge --patch</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;controller&quot;:{&quot;reconcileDisabled&quot;:true}}}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch statefulset zeebe -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$namespace</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> --patch </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">cat</span><span class="token string variable" style="color:#36acaa"> $scriptPath/sys_time_patch.yaml</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod -l </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">getLabel</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$namespace</span><span class="token string" style="color:#e3116c">&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="move-time-forward-on-int"></a>Move Time Forward on INT<a class="hash-link" href="#move-time-forward-on-int" title="Direct link to heading">#</a></h4><p>After we patched our resources we can now change the time as before.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">root@zeebe-0:/usr/local/zeebe</span><span class="token comment" style="color:#999988;font-style:italic"># date</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue May </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> 09:55:33 UTC </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zeebe-0:/usr/local/zeebe</span><span class="token comment" style="color:#999988;font-style:italic"># date +%T -s &quot;10:55:00&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:55:00</span></span><span class="token-line" style="color:#393A34"><span class="token plain">root@zeebe-0:/usr/local/zeebe</span><span class="token comment" style="color:#999988;font-style:italic"># date</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue May </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:55:01 UTC </span><span class="token number" style="color:#36acaa">2021</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the general section of our Grafana Dashboard everything looks fine. We can&#x27;t see any issues here, except that the exporting is much less than the processing.
<img alt="int-inc-1-hour-general" src="/zeebe-chaos/assets/images/int-inc-1-hour-general-f5fa293ae793ae59f4cc83da19456a2d.png"></p><p>We took a closer look at the processing panels and saw that the exporter lag a lot behind, which causes Operate lagging behind and that fewer segments are deleted.
<img alt="int-inc-1-hour-exporting" src="/zeebe-chaos/assets/images/int-inc-1-hour-exporting-ad1008f03377d042cc502110006a02fb.png"></p><p>On moving the time forward we see as expected the snapshotting has been triggered.
<img alt="int-inc-1-hour-snapshot" src="/zeebe-chaos/assets/images/int-inc-1-hour-snapshot-7f4800f402632a8efb38d4a8ef1b370a.png"></p><p>Stackdriver shows no errors for the Zeebe service. But later, in operate we observed that no new data was imported after 11:50, we moved the time at 11:55 forward. In the logs we found the following exceptions, which need to be investigated further.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Exception occurred when importing data: io.camunda.operate.exceptions.PersistenceException: Update request failed </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">operate-import-position-1.0.0_</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> and </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">-process-instance</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> with the message </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Elasticsearch exception </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">version_conflict_engine_exception, </span><span class="token assign-left variable" style="color:#36acaa">reason</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">-process-instance</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: version conflict, required seqNo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1681</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, primary term </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">. current document has seqNo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1688</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> and primary term </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The exception in more detail:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">io.camunda.operate.exceptions.PersistenceException: Update request failed for [operate-import-position-1.0.0_] and id [2-job] with the message [Elasticsearch exception [type=version_conflict_engine_exception, reason=[2-job]: version conflict, required seqNo [1765], primary term [1]. current document has seqNo [1771] and primary term [1]]].</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.camunda.operate.util.ElasticsearchUtil.executeUpdate(ElasticsearchUtil.java:271) ~[operate-els-schema-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.camunda.operate.zeebeimport.ImportPositionHolder.recordLatestLoadedPosition(ImportPositionHolder.java:100) ~[operate-qa-importer-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.camunda.operate.zeebeimport.ImportJob.call(ImportJob.java:86) ~[operate-qa-importer-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.camunda.operate.zeebeimport.RecordsReader.lambda$scheduleImport$1(RecordsReader.java:217) ~[operate-qa-importer-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.FutureTask.run(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.Thread.run(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: org.elasticsearch.ElasticsearchStatusException: Elasticsearch exception [type=version_conflict_engine_exception, reason=[2-job]: version conflict, required seqNo [1765], primary term [1]. current document has seqNo [1771] and primary term [1]]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.rest.BytesRestResponse.errorFromXContent(BytesRestResponse.java:176) ~[elasticsearch-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.client.RestHighLevelClient.parseEntity(RestHighLevelClient.java:1933) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.client.RestHighLevelClient.parseResponseException(RestHighLevelClient.java:1910) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1667) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1624) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1594) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at org.elasticsearch.client.RestHighLevelClient.update(RestHighLevelClient.java:1061) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.camunda.operate.util.ElasticsearchUtil.executeUpdate(ElasticsearchUtil.java:266) ~[operate-els-schema-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 7 more</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Suppressed: org.elasticsearch.client.ResponseException: method [POST], host [http://elasticsearch:9200], URI [/operate-import-position-1.0.0_/_update/2-job?refresh=true&amp;timeout=1m], status line [HTTP/1.1 409 Conflict]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;error&quot;:{&quot;root_cause&quot;:[{&quot;type&quot;:&quot;version_conflict_engine_exception&quot;,&quot;reason&quot;:&quot;[2-job]: version conflict, required seqNo [1765], primary term [1]. current document has seqNo [1771] and primary term [1]&quot;,&quot;index_uuid&quot;:&quot;7jsKYxw7RxWQhba-UIG5Wg&quot;,&quot;shard&quot;:&quot;0&quot;,&quot;index&quot;:&quot;operate-import-position-1.0.0_&quot;}],&quot;type&quot;:&quot;version_conflict_engine_exception&quot;,&quot;reason&quot;:&quot;[2-job]: version conflict, required seqNo [1765], primary term [1]. current document has seqNo [1771] and primary term [1]&quot;,&quot;index_uuid&quot;:&quot;7jsKYxw7RxWQhba-UIG5Wg&quot;,&quot;shard&quot;:&quot;0&quot;,&quot;index&quot;:&quot;operate-import-position-1.0.0_&quot;},&quot;status&quot;:409}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:326) ~[elasticsearch-rest-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:296) ~[elasticsearch-rest-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:270) ~[elasticsearch-rest-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestHighLevelClient.internalPerformRequest(RestHighLevelClient.java:1654) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1624) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1594) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.elasticsearch.client.RestHighLevelClient.update(RestHighLevelClient.java:1061) ~[elasticsearch-rest-high-level-client-7.12.1.jar!/:7.12.1]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at io.camunda.operate.util.ElasticsearchUtil.executeUpdate(ElasticsearchUtil.java:266) ~[operate-els-schema-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at io.camunda.operate.zeebeimport.ImportPositionHolder.recordLatestLoadedPosition(ImportPositionHolder.java:100) ~[operate-qa-importer-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at io.camunda.operate.zeebeimport.ImportJob.call(ImportJob.java:86) ~[operate-qa-importer-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at io.camunda.operate.zeebeimport.RecordsReader.lambda$scheduleImport$1(RecordsReader.java:217) ~[operate-qa-importer-1.0.0.jar!/:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.util.concurrent.FutureTask.run(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [?:?]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.lang.Thread.run(Unknown Source) [?:?]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Experiment failed</strong> ❌ </p><p>Operate was not operating normal, the exceptions were not expected.</p><p>It seems that changing the time on INT, causes some unexpected problems for Operate. We need to investigate that further and resolve them before we can continue here and make that an automated test. Furthermore, we need to investigate how problematic it is that our exporting lags behind, which is related to <a href="https://github.com/camunda-cloud/zeebe/issues/6747" target="_blank" rel="noopener noreferrer">zeebe#6747</a>, and how we can resolve that.</p><p>In general, we saw that Zeebe has no real issues with time shifts and that timers can be triggered by changing the underlying system time. Still we should make sure that our containers are running on UTC time nodes (which we do), such that we avoid issues with daylight saving time.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zeebe-chaos/tags/data">data</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2021-05-25-Reset-Clock/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zeebe-chaos/2021/06/08/Full-Disk"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Full Disk Recovery</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Corrupted Snapshot Experiment Investigation »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chaos-experiment" class="table-of-contents__link">Chaos Experiment</a><ul><li><a href="#expected" class="table-of-contents__link">Expected</a></li><li><a href="#changing-time" class="table-of-contents__link">Changing Time</a></li><li><a href="#experiment-on-benchmark-cluster" class="table-of-contents__link">Experiment on Benchmark Cluster</a></li><li><a href="#experiment-on-int" class="table-of-contents__link">Experiment on INT</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zeebe-io/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zeebe-chaos/assets/js/runtime~main.b018d4c1.js"></script>
<script src="/zeebe-chaos/assets/js/main.8955be73.js"></script>
</body>
</html>