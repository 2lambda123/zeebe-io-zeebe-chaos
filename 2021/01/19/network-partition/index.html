<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zeebe-chaos/rss.xml" title="Zeebe Chaos Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zeebe-chaos/atom.xml" title="Zeebe Chaos Blog Atom Feed"><title data-react-helmet="true">Network partitions | Zeebe Chaos</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeebe-io.github.io/zeebe-chaos/2021/01/19/network-partition"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Network partitions | Zeebe Chaos"><meta data-react-helmet="true" name="description" content="As you can see, I migrated the old chaos day summaries to github pages, for better readability."><meta data-react-helmet="true" property="og:description" content="As you can see, I migrated the old chaos day summaries to github pages, for better readability."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-01-19T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/zelldon"><meta data-react-helmet="true" property="article:tag" content="availability"><link data-react-helmet="true" rel="shortcut icon" href="/zeebe-chaos/img/zeebe-logo.png"><link data-react-helmet="true" rel="canonical" href="https://zeebe-io.github.io/zeebe-chaos/2021/01/19/network-partition"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2021/01/19/network-partition" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeebe-io.github.io/zeebe-chaos/2021/01/19/network-partition" hreflang="x-default"><link rel="stylesheet" href="/zeebe-chaos/assets/css/styles.473f1099.css">
<link rel="preload" href="/zeebe-chaos/assets/js/runtime~main.f12ded31.js" as="script">
<link rel="preload" href="/zeebe-chaos/assets/js/main.96feaff9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zeebe-chaos/"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zeebe-chaos/img/zeebe-logo.png" alt="Zeebe" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Zeebe Chaos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zeebe-chaos/">Chaos Summaries</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zeebe-io/zeebe-chaos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/11/24/Worker-count-should-not-impact-performance">Worker count should not impact performance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/11/11/Not-produce-duplicate-Keys">Not produce duplicate Keys</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/10/29/Throughput-on-big-state">Throughput on big state</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/10/05/recovery-time">Recovery (Fail Over) time</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/09/23/Old-Clients">Old-Clients</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/07/06/Slow-Network">Slow Network</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/06/08/Full-Disk">Full Disk Recovery</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/05/25/Reset-Clock">Time travel Experiment</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/04/29/Corrupted-Snapshot">Corrupted Snapshot Experiment Investigation</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/04/03/bpmn-meets-chaos-engineering">BPMN meets Chaos Engineering</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/03/30/set-file-immutable">Set file immutable</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/03/23/camunda-cloud-network-partition">Camunda Cloud network partition</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/03/09/cont-workflow-instance">Fault-tolerant processing of process instances</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/02/23/automate-deployments-dist">Automating Deployment Distribution Chaos Experiment</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/01/26/deployments">Deployment Distribution</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/zeebe-chaos/2021/01/19/network-partition">Network partitions</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower">Disconnect Leader and one Follower</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/11/24/message-correlation-after-failover">Message Correlation after Failover</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/11/11/job-timeouts">Many Job Timeouts</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/11/03/investigate-failing-tests">Investigate failing Chaos Tests</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/20/non-graceful-shutdown">Non-graceful Shutdown Broker</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/27/standalone-gw-memory">Gateway memory consumption</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/13/multiple-leader-changes">Multiple Leader Changes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/10/06/toxi-proxy">Play around with ToxiProxy</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/08/20/experiment-with-camunda-cloud">Experiment with Camunda Cloud</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/08/06/low-load">Experiment with Low Load</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/30/experiment-without-exporters">Experiment without Exporters</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/16/big-multi-instance">Big Multi Instance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/09/timer-and-huge-variables">Experiment with Timers and Huge Variables</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/07/02/extract-k8-resources">Extract K8 resources from namespace</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/25/gateway-network-partition">Gateway Network Partition</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/18/correlate-message-after-failover">Correlate Message after failover</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/11/high-cpu-gateway">High CPU load on Standalone Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zeebe-chaos/2020/06/04/first-chaos-day">First Chaos Day!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Network partitions</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-01-19T00:00:00.000Z" itemprop="datePublished">January 19, 2021</time> · 8 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/zelldon.png" alt="Christopher Zell"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zelldon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christopher Zell</span></a></div><small class="avatar__subtitle" itemprop="description">Chaos Engineer @ Zeebe</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>As you can see, I migrated the old chaos day summaries to github pages, for better readability.
I always wanted to play around with github pages and jekyll so this was a good opportunity. I hope you like it. 😄</p><p>On the last Chaos Day, we experimented with disconnecting a Leader and <em>one</em> follower. We expected no bigger disturbance, since we still have quorum and can process records. Today I want to experiment with bigger network partitions.</p><ul><li>In the first chaos experiment: I had a cluster of 5 nodes and split that into two groups, the processing continued as expected, since we had still quorum. 💪</li><li>In the second chaos experiment: I split the cluster again into two groups, but this time we added one follower of the bigger group to the smaller group after snapshot was taken and compaction was done. The smaller group needed to keep up with the newer state, before new processing can be started again, but everything worked fine.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="first-chaos-experiment"></a>First Chaos Experiment<a class="hash-link" href="#first-chaos-experiment" title="Direct link to heading">#</a></h2><p>Say we have cluster of 5 nodes, one partition with replication factor 3 and we split the cluster in two parts (2 nodes and 3 nodes).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="expected"></a>Expected<a class="hash-link" href="#expected" title="Direct link to heading">#</a></h3><p>We expect if we partition two followers away that one part of the cluster can still continue, since it has quorum. Quorum is defined as <code>quorum=floor(nodes/2) + 1</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="actual"></a>Actual<a class="hash-link" href="#actual" title="Direct link to heading">#</a></h3><p><img alt="general" src="/zeebe-chaos/assets/images/general-77265212a425429df275210ec40dc0d3.png"></p><p>When partitioning two followers, this means we would have two groups. First group would be Broker-0 and Broker-1, the second group contains then Broker-2, Broker-3 and Broker-4. I adjusted the disconnect script from the last chaos day a bit. It looks now like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -exuo pipefail</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># this scripts expects a setup of 5 nodes with replication factor 5 or higher</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> utils.sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">partition</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getNamespace</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">gateway</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getGateway</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker0</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getBroker </span><span class="token variable string" style="color:#e3116c">&quot;0&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker0Ip</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$broker0</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$namespace</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> --template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{ { .status.podIP } }&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker1</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getBroker </span><span class="token variable string" style="color:#e3116c">&quot;1&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker1Ip</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$broker1</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$namespace</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> --template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{ { .status.podIP } }&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker2</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getBroker </span><span class="token variable string" style="color:#e3116c">&quot;2&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker2Ip</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$broker2</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$namespace</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> --template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{ { .status.podIP } }&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker3</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getBroker </span><span class="token variable string" style="color:#e3116c">&quot;3&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker3Ip</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$broker3</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$namespace</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> --template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{ { .status.podIP } }&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker4</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getBroker </span><span class="token variable string" style="color:#e3116c">&quot;4&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">broker4Ip</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$broker4</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$namespace</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa"> --template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{ { .status.podIP } }&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># To print the topology in the journal</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$gateway</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$namespace</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -- zbctl status --insecure</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># we put all into one function because we need to make sure that even after preemption the </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dependency is installed</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function-name function" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">toChangedPod</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">targetIp</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># update to have access to ip</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$namespace</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$toChangedPod</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$namespace</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$toChangedPod</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y iproute2</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$toChangedPod</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -n </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$namespace</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> unreachable </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$targetIp</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Broker 0 and 1 is one group</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker3Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker4Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker3Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker4Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Broker 2, 3 and 4 is the other group</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker3</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker3</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker4</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker4</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><img alt="general-network-partition" src="/zeebe-chaos/assets/images/general-network-partition-0-667e6f6ccbd7b800d06b9fc27fc540a6.png"></p><p>It works quite well, we can see that another broker took over the leadership and continues with processing. We reach almost the same throughput, interesting is that the activate job requests seem to scale up, which is totally unexpected! We drop now 82% of our requests because we are overloaded with activate job requests.</p><p><img alt="growing-request-network-partition" src="/zeebe-chaos/assets/images/growing-requests-network-partition-0-a3d400e4e8bec72c48189151d7bbff0d.png"></p><p>In the atomix section we can see that the both nodes, which are partitioned away, miss a lot of heatbeats and we can see the leader change, which has happened earlier.
<img alt="atomix-network-partition" src="/zeebe-chaos/assets/images/atomix-network-partition-0-d4d3535d5499fe7ae391d2626f501d31.png"></p><p>Quite early after the network partition a node preemption happened.</p><p><img alt="node-died" src="/zeebe-chaos/assets/images/node-died-0-a0f1aa1003ea8ee0c626c80a217975ec.png"></p><p>We see that the processing completely stops, two reasons here: one is that the gateway was restarted and another is that the leader was restarted and we lost quourum, since we already have the network partition in place. After the restart the Broker-4 actually should know again the other nodes, which is why the heartbeat misses stopped.</p><p><img alt="atomix-after-restart" src="/zeebe-chaos/assets/images/atomix-after-restart-ee22493581d1ecdb434285c5765e44eb.png"></p><p>After the Broker comes back the processing started again.</p><p><img alt="new-start-broker-4" src="/zeebe-chaos/assets/images/new-start-broker-4-c366161635e83933b3e5bd108ebc23fe.png"></p><p>As mentioned earlier the grpc requests increased significantly, we now drop 100% of the requests. We have ~3k incoming activate job requests.</p><p><img alt="grpc-after-restart" src="/zeebe-chaos/assets/images/grpc-after-restart-8a184cf51d1500f578f3ef9c091bcc53.png"></p><p>Some time later we can see that the grpc requests has stabilized again.</p><p><img alt="grpc-stabilized" src="/zeebe-chaos/assets/images/grpc-stabilized-bc0d89ce10d5ac3f12cad3098bc06156.png"></p><p>This should be investigated further, but we will stop here with this experiment since it worked as expected that we kept processing even if we partition two brokers away.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="second-chaos-experiment"></a>Second Chaos Experiment<a class="hash-link" href="#second-chaos-experiment" title="Direct link to heading">#</a></h2><p>After the first experiment succeeded, I wanted to experiment how the cluster behaves if we add one follower back to group one and remove it from the second group. As you might remember we have in the first group (Broker-0, Broker-1) and in the second group (Broker-2, Broker-3, Broker-4).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="expected-1"></a>Expected<a class="hash-link" href="#expected-1" title="Direct link to heading">#</a></h3><p>When the network partition is created and we continue with processing at some point a snapshot is taken and the log is compacted. The first group will not receive any events, which means it has the old state. If we now add Broker-2 to the first group we would expect that the first group now can take over, since it has quorum, and the second will stop working. Before it can start with further processing the Broker-0 and Broker-1 need to get the latest state of Broker-2. We expect that Broker-2 becomes leader in the first group, since it has the longer (latest) log.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="actual-1"></a>Actual<a class="hash-link" href="#actual-1" title="Direct link to heading">#</a></h3><p>Again same set up, 5 nodes, one partition and replication factor 3. I&#x27;m using the same script as above. I will wait until a snapshot is taken, we could also trigger it now via an end point.</p><p>We can see no difference in processing throughput after setting up the network partition again.</p><p><img alt="new-partition" src="/zeebe-chaos/assets/images/new-partition-70b12561484d135dc4fe7f01543cd558.png"></p><p>Furthermore, the grpc requests seem to be stable, so it must be something related to the gateway or leader restart.</p><p><img alt="new-grpc" src="/zeebe-chaos/assets/images/new-grpc-ca15020aa84f56bf831a442262a2f91f.png"></p><p>When we take a look at the atomix metrics we see that both brokers are missing heartbeats, which is expected. </p><p><img alt="new-heartbeats" src="/zeebe-chaos/assets/images/new-heartbeats-7313901d7e8d103c49ac15df8246d1e8.png"></p><p>Node preemption wanted to annoy me again... Broker 2 was restarted, because of node preemption. Since we had no quorum, a new election was started. Broker-2 came back voted for Broker-3, but missed soon also heartbeats, so it started an election again and became leader, because it was able to talk with all nodes again. This was not what we wanted to test, but it is nice to know that it works 😆</p><p><img alt="second-restart" src="/zeebe-chaos/assets/images/second-restart-5a3f48be2651f0086c23d6bf7a52b868.png"></p><p>So again, I re-deployed the cluster and created a snapshot by hand (via API).</p><p>For that I port-forwarded our admin port (9600)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ k port-forward zell-chaos-zeebe-1 </span><span class="token number" style="color:#36acaa">9600</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>On the leader we send the POST request to take a snapshot.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[zell zell-chaos/ cluster: zeebe-cluster ns:zell-chaos]$ curl -X POST http://localhost:9600/actuator/partitions/takeSnapshot</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;1&quot;:{&quot;role&quot;:&quot;LEADER&quot;,&quot;snapshotId&quot;:&quot;591299-1-1611061561457-718421-717758&quot;,&quot;processedPosition&quot;:723973,&quot;processedPositionInSnapshot&quot;:718421,&quot;streamProcessorPhase&quot;:&quot;PROCESSING&quot;,&quot;exporterPhase&quot;:&quot;EXPORTING&quot;,&quot;exportedPosition&quot;:722841}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can see in the metrics that a snapshot was taken (probably two, because I accidently executed the command twice).</p><p><img alt="snapshot.png" src="/zeebe-chaos/assets/images/snapshot-f716de884366a3f30bcaa747daea36c5.png"></p><p>For the Broker 2 we check whether it already received the snapshot:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell zell-chaos/ cluster: zeebe-cluster ns:zell-chaos</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X GET http://localhost:9600/actuator/partitions</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;FOLLOWER&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;snapshotId&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;595599-1-1611061566584-723972-722841&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;processedPosition&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;processedPositionInSnapshot&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;streamProcessorPhase&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;exporterPhase&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;exportedPosition&quot;</span><span class="token plain">:null</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We also verify that Broker-0 hasn&#x27;t received any snapshots nor events.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zell zell-chaos/ cluster: zeebe-cluster ns:zell-chaos</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X GET http://localhost:9600/actuator/partitions</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;FOLLOWER&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;snapshotId&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;44199-1-1611061147163-76565-53432&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;processedPosition&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;processedPositionInSnapshot&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;streamProcessorPhase&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;exporterPhase&quot;</span><span class="token plain">:null,</span><span class="token string" style="color:#e3116c">&quot;exportedPosition&quot;</span><span class="token plain">:null</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After that, we start with the disconnection to group two and connect Broker-2 to group one (Broker-0 and Broker-1).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker3Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker4Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"> retryUntilSuccess connect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> retryUntilSuccess connect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">   </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can see that we now have no leader at all, because I missed to connect the first group with Broker-2 in the reverse and disconnecting group 2 from Broker-2.</p><p><img alt="network-partition-happening.png" src="/zeebe-chaos/assets/images/network-partition-happening-333f089ad90b18a58d1e6711fc276b23.png"></p><p>After doing so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker3</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess disconnect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker4</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess connect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">retryUntilSuccess connect </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$broker2Ip</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">    </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can see in the logs but also in the metrics that snapshots are replicated to Broker-0 and Broker-1.</p><p><img alt="snapshot-metrics.png" src="/zeebe-chaos/assets/images/snapshot-metrics-e54d615ace93975f93b7224031f07140.png"></p><p>I would expect that we also see something in the atomix snapshot panels, but here it looks like only the duration is published.</p><p><img alt="atomix-snapshot-metrics.png" src="/zeebe-chaos/assets/images/atomix-snapshot-metrics-1cfd735171f66d16cffec1e816230b35.png"></p><p>After connecting the Broker&#x27;s we see that Broker-0 and Broker-1 are not missing heartbeats anymore and that a new leader has been chosen, Broker-2 which was the expected leader! </p><p><img alt="after-connect-all.png" src="/zeebe-chaos/assets/images/after-connect-all-e3ddb2f28034af3671012e2916cee6f0.png"></p><p>The processing started and cluster seem to look healthy again.</p><p><img alt="healed.png" src="/zeebe-chaos/assets/images/healed-dcae54d03eb0087d45932ad50d05d3c8.png"></p><p>Experiment was successful! 👍</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="new-issues"></a>New Issues<a class="hash-link" href="#new-issues" title="Direct link to heading">#</a></h2><ul><li>Unexpected request count on network partition/node restart</li><li>Snapshot metrics are unclear, which show what and Atomix snapshot metrics are not showing values</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="participants"></a>Participants<a class="hash-link" href="#participants" title="Direct link to heading">#</a></h2><ul><li>@zelldon</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zeebe-chaos/tags/availability">availability</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/zeebe-io/zeebe-chaos/blob/master/chaos-days/blog/2021-01-19-network-partition/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zeebe-chaos/2021/01/26/deployments"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Deployment Distribution</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zeebe-chaos/2021/01/07/disconnect-leader-and-follower"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Disconnect Leader and one Follower »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#first-chaos-experiment" class="table-of-contents__link">First Chaos Experiment</a><ul><li><a href="#expected" class="table-of-contents__link">Expected</a></li><li><a href="#actual" class="table-of-contents__link">Actual</a></li></ul></li><li><a href="#second-chaos-experiment" class="table-of-contents__link">Second Chaos Experiment</a><ul><li><a href="#expected-1" class="table-of-contents__link">Expected</a></li><li><a href="#actual-1" class="table-of-contents__link">Actual</a></li></ul></li><li><a href="#new-issues" class="table-of-contents__link">New Issues</a></li><li><a href="#participants" class="table-of-contents__link">Participants</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/zeebe" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.camunda.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zeebe-io/zeebe-chaos/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Zeebe Chaos. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zeebe-chaos/assets/js/runtime~main.f12ded31.js"></script>
<script src="/zeebe-chaos/assets/js/main.96feaff9.js"></script>
</body>
</html>