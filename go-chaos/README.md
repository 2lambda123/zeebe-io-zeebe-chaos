# Zbchaos — A new fault injection tool for Zeebe

During Summer Hackdays 2022, I worked on a project called “Zeebe chaos” (zbchaos), a fault injection CLI tool. 
This allows us engineers to more easily run chaos experiments against Zeebe, build up confidence in the system’s capabilities, 
and discover potential weaknesses.

Read more about it on [medium.com](https://medium.com/@zelldon91/zbchaos-a-new-fault-injection-tool-for-zeebe-cbda56c5ba8d)

## Building the project

You can use the existing Makefile to build the project:

```
make build
```

## Run tests

You can use the existing Makefile to execute the tests, it will build the project before

```
make test
```

## Release

The release is currently not really automated.

### Checkout and pull the latest state on main 
```sh
git checkout main
git fetch --all
git pull origin main
```
### Determine the next version.
  Either check the [releases page](https://github.com/zeebe-io/zeebe-chaos/releases/) or run
```sh
git tag | sort -Vr | head -n1
```
### Build zbchaos

```
cd go-chaos/
export RELEASE_VERSION=zbchaosv0.X.0; ./build.sh
```
This will built the zbchaos artifacts with the version injected.

### Create a tag

```
git tag "$RELEASE_VERSION"
git push origin "$RELEASE_VERSION"
```

### Create a release

[Create a new release on github](https://github.com/zeebe-io/zeebe-chaos/releases/new), use the autogenerated changelog.

### Upload the artifacts
You find the artifacts in the `dist` folder.

### Publish the release
This will trigger the docker image to built

### Update the deployment

Adjust the deployment file [here](https://github.com/zeebe-io/zeebe-chaos/blob/main/go-chaos/deploy/deployment.yaml), update the docker image tag.

> **Note:**
> This will not update the deployed resources, this is not automated yet.

You can either apply the deployment again in the corresponding Kubernetes namespace (e.g. testbench-1-x-prod)

```
kubectl apply -f go-chaos/deploy/deployment.yaml 
```

or edit the existing deployment

```
kubectl edit deployments.apps zbchaos-worker
```

